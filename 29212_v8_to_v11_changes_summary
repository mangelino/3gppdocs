Changes Gx v8 to v11

#### 4.5.2.5 Usage Monitoring Control

Usage monitoring may be performed for service data flows associated with
one or more PCC rules.

The provisioning of usage monitoring control per PCC rule shall be
performed using the PCC rule provisioning procedure. For a PCRF-provided
PCC rule, the monitoring key shall be set using the Monitoring-Key AVP
within the Charging-Rule-Definition AVP of the PCC rule. For a
predefined PCC rule, the monitoring key shall be included in the rule
definition at the PCEF. Usage monitoring shall be activated both for
service data flows associated with predefined PCC rules and dynamic PCC
rules, including rules with deferred activation and/or deactivation
times while those rules are active.

NOTE: It is recommended that the same traffic is not monitored by both
PCC rules in the PCEF and ADC rules in the TDF with active usage
monitoring at the same time. This avoids double counting.

#### 4.5.2.6 Redirect function

The PCRF may provide the redirect instruction for a dynamic PCC rule to
the PCEF enhanced with ADC. The Provisioning shall be performed using
the PCC rule provisioning procedure. The redirect instruction shall be
encoded using a Redirect-Information AVP within the
Charging-Rule-Definition AVP of the dynamic PCC rule.

For a dynamic PCC rule, the redirect address may be provided as part of
the dynamic PCC rule or may be preconfigured in the PCEF. A redirect
destination provided within the Redirect-Server-Address AVP in a dynamic
PCC Rule shall override the redirect destination preconfigured in the
PCEF for this PCC rule.

NOTE: The PCEF uses the preconfigured redirection address only if it can
be applied to the application traffic being detected, e.g. the
redirection destination address could be preconfigured on a per
application identifier basis.

If Redirect-Information AVP is provided for a dynamic PCC rule, the PCEF
shall implement the redirection for the detected application’s uplink
traffic. If the Redirect-Server-Address AVP is provided within the
Redirect-Information AVP and the Redirect-Support AVP is not set to
REDIRECTION\_DISABLED, the PCEF shall redirect the detected
application’s uplink traffic to this address. In this case, the redirect
address type (e.g. IPv4, IPv6 or URL) shall be defined by the
Redirect-Address-Type AVP. If the Redirect-Server-Address AVP is not
provided, the redirection address preconfigured in the PCEF shall be
used instead. If the Redirect-Server-Address AVP is not provided and the
redirection address is not preconfigured in the PCEF for this PCC rule,
the PCEF shall perform PCC Rule Error Handling as specified in subclause
4.5.12.

When the PCRF wants to disable the redirect function for an already
installed PCC Rule, the PCRF shall update the PCC rule including the
Redirect-Information AVP with Redirect-Support AVP set to
REDIRECTION\_DISABLED.

### 4.5.11 Provisioning of Event Report Indication

Whenever the PCEF subscribes to an event report indication by using the
CCR command, the PCRF shall only send the corresponding currently
applicable values which have been updated (e.g. 3GPP-User-Location-Info,
3GPP2-BSID, etc.) to the PCEF in the CCA if available. In this case, the
Event-Trigger AVPs shall not be included.

NOTE: The PCRF can get the currently applicable values during the IP-CAN
session establishment procedure or during the information reporting from
the BBERF when the BBERF gets event subscription from the PCRF as
defined in subclause 5.3.7.

When multiple BBERFs exist as in flow mobility case, the PCEF may
subscribe to different event triggers at different BBERFs. In this case,
the PCEF shall include the Routing-IP-Address AVP within the
Event-Report-Indication AVP to identify the BBERF for which the event
triggers are to be installed. If the PCEF did not include
Routing-IP-Address AVP within the Event-Report-Indication AVP, then the
Event-Report-Indication AVP applies to all the BBERFs and the same event
triggers will be installed on all of them.

### 4.5.15 IMS Emergency Session Support

#### 4.5.15.1 Functional Entities

The PCRF shall store a configurable list of Emergency APNs that are
valid for the operator to which the PCRF belongs to.

For emergency APNs, the IMSI may not be present. The PCEF, BBERF and
PCRF shall support request for PCC/QoS Rules that do not include an
IMSI.

#### 4.5.15.2 PCC procedures for Emergency services over Gx reference point

##### 4.5.15.2.1 Request for PCC Rules for Emergency services

The PCEF executes the same procedure as for a Request for PCC Rules
unrelated to Emergency Services described in subclause 4.5.1.

A PCEF that requests PCC Rules at IP-CAN Session Establishment shall
send a CCR command with CC-Request-Type AVP set to value
"INITIAL\_REQUEST" and the Called-Station-Id AVP including the Emergency
APN. The PCEF may include the IMSI within the Subscription-Id AVP and if
the IMSI is not available the PCEF shall include the IMEI within the
User-Equipment-Info AVP. The PCEF may include the rest of the attributes
described in clause 4.5.1.

Any PCEF-initiated requests for PCC Rules for an IMS Emergency service
that include the "RESOURCE\_MODIFICATION\_REQUEST" Event-Trigger AVP
shall be rejected by the PCRF with the error
DIAMETER\_ERROR\_TRAFFIC\_MAPPING\_INFO\_REJECTED.

If the PCRF detects that the initial or subsequent CCR command shall be
rejected, it shall execute the procedure for the type of Gx experimental
result code described in subclause 4.5.1.

##### 4.5.15.2.2 Provisioning of PCC Rules for Emergency services

###### 4.5.15.2.2.1 Provisioning of PCC Rules at Gx session establishment

The PCRF shall detect that a Gx session is restricted to IMS Emergency
services when a CCR command is received with a CC-Request-Type AVP set
to value "INITIAL\_REQUEST" and the Called-Station-Id AVP includes a PDN
identifier that matches one of the Emergency APNs from the configurable
list. The PCRF:

- shall provision PCC Rules restricting the access to Emergency Services
(e.g. P-CSCF(s), DHCP(s) and DNS (s) and SUPL(s) addresses) as required
by local operator policies in a CCA command according to the procedures
described in subclause 4.5.2.

- may provision the authorized QoS that applies to the default EPS
bearer within the Default-EPS-Bearer-QoS AVP in a CCA command according
to the procedures described in subclause 4.5.5.10 except for obtaining
the authorized QoS upon interaction with the SPR. The value for the
Priority-Level AVP shall be assigned as required by local operator
policies (e.g. if an IMS Emergency session is prioritized the
Priority-Level AVP may contain a value that is reserved for an operator
domain use of IMS Emergency sessions). If the IP-CAN-Type AVP is
assigned to "3GPP-EPS" or "3GPP-GPRS" the values for
Pre-emption-Capability AVP and the Pre-emption-Vulnerability AVP shall
be assigned as required by local operator policies.

- may provision the authorized QoS that applies to an APN within the
APN-Aggregate-Max-Bitrate UL/DL in a CCA command according to the
procedures described in subclause 4.5.5.7.

- shall always assign NW mode to the PCC Rules that are bound to an
IP-CAN session restricted to Emergency services.

When the PCEF detects that the provisioning of PCC Rules failed, it
shall execute the procedure for the type of Gx experimental result code
described in subclause 4.5.2.

###### 4.5.15.2.2.2 Provisioning of PCC Rules for Emergency Services 

When the PCRF receives IMS service information from the AF for an
Emergency service and derives authorized PCC Rules from the service
information, the Priority-Level AVP in the QoS information within the
PCC Rule shall be assigned a priority as required by local operator
policies (e.g. if an IMS Emergency session is prioritized the
Priority-Level AVP may contain a value that is reserved for an operator
domain use of IMS Emergency session). If the IP-CAN Type AVP is assigned
to "3GPP-EPS" or "3GPP-GPRS" and the Pre-emption-Capability AVP and
Pre-emption-Vulnerability AVP were received within the
Allocation-Retention-Priority AVP in the Default-EPS-Bearer-QoS AVP in
the initial CCR command, the values of the Pre-emption-Capability AVP
and Pre-emption-Vulnerability AVP shall also be assigned as required by
local operator policies.

The PCRF shall immediately initiate a PUSH procedure as described in
subclause 4.5.2.0 to provision PCC Rules and the procedures described in
subclause 4.5.5.2 to provision the authorized QoS per service data flow.

The provisioning of PCC Rules at the PCEF that require the establishment
of a dedicated bearer for emergency services shall cancel the inactivity
timer in the PCEF, if running.

Any PCEF-initiated request for PCC Rules for an IMS Emergency service
triggered by Event-Trigger AVP assigned to
“RESOURCE\_MODIFICATION\_REQUEST” (i.e. UE-initiated resource
reservation) shall be rejected by the PCRF with the error
DIAMETER\_ERROR\_TRAFFIC\_MAPPING\_INFO\_REJECTED. If the Bearer Control
Mode is assigned to "UE\_ONLY" and the PCRF receives a request for PCC
Rules that are associated with an Emergency service, it shall provision
PCC Rules as described in subclause 4.5.2 and the authorized QoS per
service data flow as described in subclause 4.5.2.2.

The PCEF shall execute the procedures described in subclause 4.5.2.0 and
subclause 4.5.5.3 to ensure that a new IP-CAN bearer is established for
the Emergency service.

When the PCEF detects that the provisioning of PCC Rules failed, it
shall execute the procedure for the type of Gx experimental result code
described in subclause 4.5.12.

##### 4.5.15.2.3 Removal of PCC Rules for Emergency Services

The reception of a request to terminate an AF session for an IMS
Emergency service by the PCRF triggers the removal of PCC Rules assigned
to the terminated IMS Emergency Service from the PCEF by using a RAR
command with Charging-Rule-Remove AVP including the removed PCC Rules.

At reception of a RAR that removes one or several PCC Rules from an
IP-CAN Session restricted to emergency services the PCEF shall:

- when all PCC Rules bound to an IP-CAN bearer are removed, initiate an
IP-CAN bearer termination procedure as defined in subclause 4.5.8.

- when not all PCC Rule bound an IP-CAN bearer are removed, initiate an
IP-CAN bearer modification procedure as defined in subclause 4.5.2 and
subclause 4.5.5.1.

In addition, the PCEF shall initiate an inactivity timer if all PCC
Rules with a QCI other than the default bearer QCI or the QCI used for
IMS signalling were removed from the IP-CAN session restricted to
Emergency Services. When the inactivity timer expires the PCEF shall
initiate an IP-CAN session termination procedure as defined in subclause
4.5.7.

##### 4.5.15.2.4 Removal of PCC Rules at Gx session termination

The reception of a request to terminate the IP-CAN session restricted to
IMS Emergency session shall trigger the termination of the Gx session
for IMS Emergency session as defined in subclause 4.5.7.

### 4.5.16 Requesting Usage Monitoring Control 

The PCRF may indicate, via the Gx reference point, the need to apply
monitoring control for the accumulated usage of network resources on an
IP-CAN session basis. Usage is defined as volume of user plane traffic.
The data collection for usage monitoring control shall be performed per
monitoring key, which may apply for a single Service Data Flow, a set of
Service Data Flows or for all the traffic in an IP-CAN session.

If the PCRF requests usage monitoring control and if at this time, the
PCRF is not subscribed to the "USAGE\_REPORT" Event-Trigger, the PCRF
shall include the Event-Trigger AVP, set to the value "USAGE\_REPORT",
in a CC-Answer or RA-Request. The PCRF shall not remove the
"USAGE\_REPORT" Event-Trigger AVP while usage monitoring is still active
in the PCEF.

At IP-CAN session establishment and modification, the PCRF may provide
the applicable thresholds for usage monitoring control to the PCEF,
together with the respective monitoring keys. To provide the initial
threshold for one or more monitoring key(s), the PCRF may include the
threshold in either RA-Request or in the response of a CC-Request
initiated by the PCEF.

During the IP-CAN session establishment, the PCRF may receive
information about total allowed usage per PDN and/ or per UE from the
SPR, i.e. the overall amount of allowed traffic volume that are to be
monitored for the PDN connections of a user and/or total allowed usage
for Monitoring key(s) per PDN and UE

NOTE: The details associated with the Sp reference point are not
specified in this Release.

In order to provide the applicable threshold for usage monitoring
control, the PCRF shall include a Usage-Monitoring-Information AVP per
monitoring key. The threshold level shall be provided in its
Granted-Service-Unit AVP. Threshold levels may be defined for:

- the total volume only; or

- the uplink volume only; or

- the downlink volume only; or

- the uplink and downlink volume.

The PCRF shall provide the applicable threshold(s) in the
CC-Total-Octets, CC-Input-Octets or CC-Output-Octets AVPs of the
Granted-Service-Unit AVP. The monitoring key shall be provided in the
Monitoring-Key AVP. The PCRF may provide multiple usage monitoring
control instances. The PCRF shall indicate if the usage monitoring
instance applies to the IP-CAN session or to one or more PCC rules. For
this purpose, the Usage-Monitoring-Level AVP may be provided with a
value respectively set to SESSION\_LEVEL or PCC\_RULE\_LEVEL. The PCRF
may provide one usage monitoring control instance applicable at IP-CAN
session level and one or more usage monitoring instances applicable at
PCC Rule level.

The PCRF may provide a Monitoring-Time AVP to the PCEF for the
monitoring keys(s) in order to receive reports for the accumulated usage
before and after the monitoring time occurs within the report triggered
by the events defined in 4.5.17.1-4.5.17.5. In such a case, there may be
two instances of Granted-Service-Unit AVP within
Usage-Monitoring-Information AVP per monitoring key. One of them
indicates the threshold levels before the monitoring time occurs, and
the other one, which includes Monitoring-Time AVP, indicates the
subsequent threshold levels after the monitoring time occurs. The
detailed functionality in such a case is defined by 4.5.17.6.

If the PCRF wishes to modify the threshold level for one or more
monitoring keys, the PCRF shall provide the thresholds for all the
different levels applicable to the corresponding monitoring key(s).

If the PCRF wishes to modify the monitoring key for the session level
usage monitoring instance, it shall disable the existing session level
monitoring usage instance following the procedures defined in 4.5.17.3
and shall provide a new session level usage monitoring instance
following the procedures defined in this clause. The PCRF may enable the
new session level usage monitoring instance and disable the existing
session level usage monitoring instance in the same command.

When the accumulated usage is reported in a CCR command, the PCRF shall
indicate to the PCEF if usage monitoring shall continue for that IP-CAN
session, usage monitoring key, or both as follows:

- If monitoring shall continue for specific level(s), the PCRF shall
provide the new thresholds for the level(s) in the CC-Answer using the
same AVP as before (CC-Total-Octets, CC-Input-Octets or CC-Output-Octets
AVP within the Granted-Service-Unit AVP); - otherwise, if the PCRF
wishes to stop monitoring for specific level(s) the PCRF shall not
include an updated usage threshold in the CCA command for the stopped
level(s) i.e. the corresponding CC-Total-Octets, CC-Input-Octets or
CC-Output-Octets AVPs shall not be included within Granted-Service-Units
AVP.

When usage monitoring is enabled, the PCRF may request the PCEF to
report accumulated usage for one or more enabled monitoring keys
regardless if a usage threshold has been reached by sending to the PCEF
within the Usage-Monitoring-Information AVP the Usage-Monitoring-Report
AVP set to the value USAGE\_MONITORING\_REPORT\_REQUIRED. The PCRF shall
only require PCEF to report accumulated usage for one or more monitoring
keys in a CC-Answer when the PCEF has not provided accumulated usage in
the CC-Request for the same monitoring key(s).

To specify the usage monitoring key for which usage is requested the
PCRF shall include the usage monitoring key within the Monitoring-Key
AVP within the Usage-Monitoring-Information AVP. To request usage be
reported for all enabled usage monitoring keys the PCRF shall omit the
Monitoring-Key.

The PCRF shall process the usage reports and shall perform the actions
as appropriate for each report.

### 4.5.17 Reporting Accumulated Usage

#### 4.5.17.0 General

When usage monitoring is enabled, the PCEF shall measure the volume of
the IP-CAN session or the volume of the applicable service data flows
and report accumulated usage to the PCRF in the following conditions:

- when a usage threshold is reached;

- when all PCC rules for which usage monitoring is enabled for a
particular usage monitoring key are removed or deactivated;

- when usage monitoring is explicitly disabled by the PCRF;

- when an IP-CAN session is terminated;

- when requested by the PCRF;

To report accumulated usage for a specific monitoring key the PCEF shall
send a CC-Request with the Usage-Monitoring-Information AVP including
the accumulated usage since the last report. For each of the enabled
monitoring keys to be reported, the Usage-Monitoring-Information AVP
shall include the monitoring key in the Monitoring-Key AVP and the
accumulated volume usage in the [Used-Service-Unit
AVP](http://cpi.al.sw.ericsson.se/alexserv?ID=4346&DB=22605-sapcr3i09a.alx&FN=2_15519-CSH109004_5-V2Uen.A.html#TOP#TOP).
Accumulated volume reporting shall be done for the total volume, the
uplink volume or the downlink volume as requested by the PCRF, and set
in CC-Total-Octets, CC-Input-Octets or CC-Output-Octets AVPs of
Used-Service-Unit AVP respectively. The PCEF shall continue to perform
volume measurement after the report until instructed by the PCRF to stop
the monitoring.

In case a Monitoring-Time AVP was provided by the PCRF within one
instance of the Granted-Service-Unit AVP included within the
Usage-Monitoring-Information AVP for the usage monitoring control
request, the PCEF shall report as defined in 4.5.17.6.

For cases where the PCRF indicates in a CC-Answer command whether the
usage monitoring shall continue as a response to the reporting of
accumulated usage in a CCR command, the PCEF shall behave as follows

- if the PCRF provisions an updated usage threshold in the CCA command,
the monitoring continues using the updated threshold value provisioned
by the PCRF;

- otherwise, if the PCRF does not include an updated usage threshold in
the CCA command, the PCEF shall not continue usage monitoring for that
IP-CAN session, usage monitoring key, or both as applicable.

NOTE: When the PCRF indicates that usage monitoring shall not continue
in the CCA, the PCEF does not report usage which has accumulated between
sending the CCR and receiving the CCA.

Upon receiving the reported usage from the PCEF, the PCRF shall deduct
the value of the usage report from the total allowed usage for that
IP-CAN session, usage monitoring key, or both as applicable, and the
PCRF may also derive the PCC rules based on the remaining allowed usage
or reported usage and provision them to the PCEF.

Additional procedures for each of the scenarios above are described in
the following subclauses of 4.5.17.

#### 4.5.17.1 Usage Threshold Reached

When usage monitoring is enabled for a particular monitoring key, the
PCEF shall measure the volume of all traffic for the IP-CAN session or
the corresponding service data flows and notify the PCRF when a usage
threshold for that monitoring key is reached and report the accumulated
usage for that monitoring key and include the "USAGE\_REPORT"
Event-Trigger in a CCR command with CC-Request Type AVP set to the value
"UPDATE\_REQUEST" by following the procedures to report accumulated
usage defined in clause 4.5.17.

#### 4.5.17.2 PCC Rule Removal

When the PCRF removes or deactivates the last PCC rule associated with a
usage monitoring key in an RAR or CCA command in response to a CCR
command not related to reporting usage for the same monitoring key, the
PCEF shall send a new CCR command with the CC-Request-Type set to the
value "UPDATE\_REQUEST" including the Event-Trigger set to
"USAGE\_REPORT" to report accumulated usage for the usage monitoring key
within the Usage-Monitoring-Information AVP using the procedures to
report accumulated usage defined in clause 4.5.17.

When the PCEF reports that the last PCC rule associated with a usage
monitoring key is inactive, the PCEF shall report the accumulated usage
for that monitoring key within the same CCR command if the
Charging-Rule-Report AVP was included in a CCR command; otherwise, if
the Charging-Rule-Report AVP was included in an RAA command, the PCEF
shall send a new CCR command to report accumulated usage for the usage
monitoring key.

#### 4.5.17.3 Usage Monitoring Disabled

Once enabled, the PCRF may explicitly disable usage monitoring as a
result of receiving a CCR from the PCEF which is not related to
reporting usage, other external triggers (e.g., receiving an AF request,
subscriber profile update), or a PCRF internal trigger. When the PCRF
disables usage monitoring, the PCEF shall report the accumulated usage
which has occurred while usage monitoring was enabled since the last
report.

To disable usage monitoring for a monitoring key, the PCRF shall send
the Usage-Monitoring-Information AVP including only the applicable
monitoring key within the Monitoring-Key AVP and the
Usage-Monitoring-Support AVP set to USAGE\_MONITORING\_DISABLED.

When the PCRF disables usage monitoring in a RAR or CCA command, the
PCEF shall send a new CCR command with CC-Request Type AVP set to the
value "UPDATE\_REQUEST" and the Event-Trigger AVP set to "USAGE\_REPORT"
to report accumulated usage for the disabled usage monitoring key(s).

#### 4.5.17.4 IP-CAN Session Termination

At IP-CAN session termination the PCEF shall send the accumulated usage
information for all monitoring keys for which usage monitoring is
enabled in the CCR command with the CC-Request-Type AVP set to the value
"TERMINATION\_REQUEST" using the procedures to report accumulated usage
defined in clause 4.5.17.

If all IP-CAN sessions of a user to the same APN are terminated, the
PCRF may store the remaining allowed usage, i.e. the information about
the remaining overall amount of resources, in the SPR.

#### 4.5.17.5 PCRF Requested Usage Report

When the PCEF receives the Usage-Monitoring-Information AVP including
the Usage-Monitoring-Report AVP set to the value
USAGE\_MONITORING\_REPORT\_REQUIRED, the PCEF shall send a new CCR
command with CC-Request Type AVP set to the value "UPDATE\_REQUEST" and
the Event-Trigger AVP set to "USAGE\_REPORT" to report accumulated usage
for the monitoring key received in the Usage-Monitoring-Information AVP
using the procedures to report accumulated usage defined in clause
4.5.17. If the Monitoring-Key AVP was omitted in the received
Usage-Monitoring-Information AVP, the PCEF shall send the accumulated
usage for all the monitoring keys that were enabled at the time the
Usage-Monitoring-Information was received.

#### 4.5.17.6 Report in case of Monitoring Time provided

If Monitoring-Time AVP was provided within one instance of the
Granted-Service-Unit AVP included within the
Usage-Monitoring-Information AVP by the PCRF, and if the PCEF needs to
report the accumulated usage when one of the events defined in subclause
4.5.17.1-4.5.17.5 occurs before the monitoring time, the PCEF shall
report the accumulated usage as defined in subclause 4.5.17.1-4.5.17.5
and the PCEF shall not retain the monitoring time; otherwise,

- If two instances of the Granted-Service-Unit AVP are provided by the
PCRF, the PCEF shall reset the usage threshold to the value of the
Granted-Service-Unit AVP with the Monitoring-Time AVP.

- If only one instance of the Granted-Service-Unit AVP is provided by
the PCRF, the PCEF shall reset the usage threshold to the remaining
value of the Granted-Service-Unit AVP previously sent by the PCRF (i.e.
excluding the accumulated volume usage).

- For both cases, the usage report from the PCEF shall include two
instances of the Used-Service-Unit AVP, one of them to indicate the
usage before the monitoring time and the other one accompanied by the
Monitoring-Time AVP under the same Used-Service-Unit AVP to indicate
the usage after the monitoring time.

When the PCRF receives the accumulated usage report in a CCR command,
the PCRF shall indicate to the PCEF if usage monitoring shall continue
as defined in subclause 4.5.16. The PCRF may provide the Monitoring-Time
AVP again within one instance of the Granted-Service-Unit AVP if reports
for the accumulated usage before and after the provided monitoring time
are required.

### 4.5.18 IMS Restoration Support

In order to support IMS Restoration procedures (refer to 3GPP TS 23.380
\[33\]), PCRF needs to convey the AF address to the PCEF. In order to do
so, in case AF provisions information about the AF signalling flows
between the UE and the AF, as defined in 3GPP TS 29.214 \[10\] Section
4.4.5a, the PCRF shall install the corresponding dynamic PCC rules (if
not installed before) by triggering a RAR message. The PCRF shall
provide the Charging-Rule-Install AVP including the
Charging-Rule-Definition AVP(s). The Charging-Rule-Definition AVP shall
include in the Flow-Information AVP the signalling flows between UE and
the AF. The Charging-Rule-Definition AVP shall also include the
AF-Signalling-Protocol AVP set to the value corresponding to the
signalling protocol used between the UE and the AF.

The PCEF shall acknowledge the command by sending an RAA command to the
PCRF and shall initiate the corresponding bearer procedure if required.
The PCEF shall extract the AF address from the PCC rules and use it for
the monitoring procedure as defined for the different access types. See
Annex A & B.

NOTE: The PCEF will use the AF-Signalling-Protocol AVP to check if, for
the applicable protocol, monitoring procedure has to be started for the
AF address included in the PCC Rules.

In case AF de-provisions information about the AF signalling flows
between the UE and the AF, as defined in 3GPP TS 29.214 \[10\] Section
4.4.5a, the PCRF shall remove the corresponding dynamic PCC rules by
triggering a RAR message. The PCRF shall provide the
Charging-Rule-Remove AVP including the corresponding Charging-Rule-Name
AVP(s).

The PCEF shall acknowledge the command by sending a RAA command to the
PCRF. The PCEF shall stop the monitoring procedure for the AF address
included in the removed PCC rule.

### 4.5.19 Multimedia Priority Support

#### 4.5.19.1 PCC Procedures for Multimedia Priority services over Gx reference point

##### 4.5.19.1.1 Provisioning of PCC Rules for Multimedia Priority Services

The provision of PCC Rules corresponding to both MPS and non-MPS service
shall be performed as described in subclause 4.5.2.0.

When the PCRF derives PCC Rules corresponding to MPS service, the ARP
and QCI shall be set as appropriate for the prioritized service, e.g. an
IMS Multimedia Priority Service.

When the PCRF derives PCC Rules corresponding to non-MPS service, the
PCRF shall generate the PCC Rules as per normal procedures. At the time
the Priority EPS Service is invoked (i.e.MPS EPS Priority and MPS
Priority Level are set), the PCRF shall upgrade the ARP and/or change
QCI also for the PCC Rules corresponding to non-MPS service. The PCRF
shall change the ARP and/or QCI modified for the Priority EPS Bearer
service to an appropriate value according to PCRF decision.

When the PCRF receives a CCR command with CC-Request-Type AVP set to
value "INITIAL\_REQUEST", the PCRF shall check whether any of these
parameters is stored in the SPR: MPS EPS Priority, MPS Priority Level
and/or IMS Signalling Priority. The PCRF shall derive the applicable PCC
rules and default bearer QoS based on that information. If the IMS
Signalling Priority is set and the Called-Station-Id AVP corresponds to
an APN dedicated for IMS, the PCRF shall assign an ARP corresponding to
MPS for the default bearer and for the PCC Rules corresponding to the
IMS signalling bearer. If the Called-Station-Id AVP does not correspond
to an APN dedicated for IMS, the ARP shall be derived without
considering IMS Signalling Priority.

NOTE: Subscription data for MPS is provided to PCRF through the Sp
reference point.

Once the PCRF receives a notification of a change in MPS EPS Priority,
MPS Priority Level and/or IMS Signalling Priority from the SPR, the PCRF
shall make the corresponding policy decisions (i.e. ARP and/or QCI
change) and, if applicable, shall initiate a RAR command to provision
the modified data.

NOTE 1: The details associated with the Sp reference point are not
specified in this Release. The SPR’s relation to existing subscriber
databases is not specified in this Release.

NOTE 2: The MPS Priority Level is one among other input data such as
operator policy for the PCRF to set the ARP.

##### 4.5.19.1.2 Invocation/Revocation of Priority EPS Bearer Services

When a Priority EPS Bearer Service is invoked, the PCRF shall

- Derive the corresponding PCC Rules with the ARP and QCI set as
appropriate for a prioritized service.

- Set the ARP and QCI of the default bearer as appropriate for a
Priority EPS Bearer Service.

- Set the ARP and QCI of PCC Rules installed before the activation of
the Priority EPS Bearer Service to the ARP and QCI as appropriate for
the Priority EPS Bearer Service.

When a Priority EPS Bearer Service is revoked, the PCRF shall

- Delete the PCC Rules corresponding to the Priority EPS Bearer Service
if they were previously provided.

- Set the ARP and QCI of the default bearer to the normal ARP and QCI.

- Set the ARP and QCI of all active PCC Rules as appropriate for the
PCRF.

NOTE: The activation/deactivation of a Priority EPS Bearer Service
requires explicit invocation/revocation via SPR MPS user profile (MPS
EPS Priority, MPS Priority Level). An AF for MPS Priority Service can
also be used to provide Priority EPS Bearer Services using
network-initiated resource allocation procedures (via interaction with
PCC) for originating accesses.

The PCRF shall provision the PCEF with the applicable PCC Rules upon
Priority EPS Bearer Service activation and deactivation as described in
subclause 4.5.2.0. The provision of the QoS information applicable for
the PCC Rules shall be performed as described in subclause 4.5.5.2. The
provision of QoS information for the default bearer shall be performed
as described in subclause 4.5.5.9.

##### 4.5.19.1.3 Invocation/Revocation of IMS Multimedia Priority Services

If the PCRF receives service information including an MPS session
indication and the service priority level from the P-CSCF or at
reception of the indication that IMS Signalling Priority is active for
the IP-CAN session, the PCRF shall:

- set the ARP of the default bearer as appropriate for the prioritized
service;

- if required, set the ARP of all PCC rules assigned to the IMS
signalling bearer as appropriate for IMS Multimedia Priority Services;

- derive the PCC Rules corresponding to the IMS Multimedia Priority
Service and set the ARP of these PCC Rules based on the information
received over Rx.

If the PCRF detects that the P-CSCF released all the MPS session and the
IMS Signalling Priority has been deactivated for the IP-CAN session the
PCRF shall

- delete the PCC Rules corresponding to the IMS Multimedia Priority
Service;

- set the ARP of the default bearer as appropriate for the IMS
Multimedia Priority set to inactive;

- replace the ARP of all PCC Rules assigned to the IMS signalling bearer
as appropriate when the IMS Multimedia Priority is inactive.

The PCRF shall provision the PCEF with the applicable PCC Rules upon MPS
session initiation and release as described in subclause 4.5.2.0. The
provision of the QoS information applicable for the PCC Rules shall be
performed as described in subclause 4.5.5.2. The provision of QoS
information for the default bearer shall be performed as described in
subclause 4.5.5.9.

### 4.5.20 Sponsored Data Connectivity 

Sponsored data connectivity may be performed for service data flows
associated with one or more PCC rules if the information about the
sponsor, the application service provider and optionally the threshold
values are provided by the AF.

The provisioning of sponsored data connectivity per PCC rule shall be
performed using the PCC rule provisioning procedure. The sponsor
identity shall be set using the Sponsor-Identity AVP within the
Charging-Rule-Definition AVP of the PCC rule. The application service
provider identity shall be set using the
Application-Service-Provider-Identity AVP within the
Charging-Rule-Definition AVP of the PCC rule. Sponsor-Identity AVP and
Application-Service-Provider-Identity AVP shall be included if the
Reporting-Level AVP is set to the value SPONSORED\_CONNECTIVITY\_LEVEL.

When receiving the flow based usage thresholds from the AF, the PCRF
shall use the sponsor identity to generate a monitoring key. The PCRF
may also request usage monitoring control following the procedure
specified in clause 4.5.16, in this case, only the flow based usage is
applied for the sponsored data connectivity. If requested, the PCEF may
also report the usage to the PCRF following the procedure specified in
clause 4.5.17.

### 4.5.21 PCRF Failure and Restoration

If the PCEF needs to send an IP-CAN session modification request towards
a PCRF which is known to have restarted since the IP-CAN session
establishment, the PCEF should not send the IP-CAN session modification
request towards a PCRF and the PCEF may tear down the associated PDN
connection based on operator policy, by initiating PDN connection
deactivation procedure. Emergency and eMPS sessions should not be torn
down.

NOTE 1: This mechanism enables the clean up of PDN connections affected
by the PCRF failure and leads the UE to initiate a UE requested PDN
connectivity procedure for the same APN.

NOTE 2: The method the PCEF uses to determine that a PCRF has restarted
is not specified in this release.

### 4.5.22 Reporting Access Network Information

If the AF requests the PCRF to report the access network information,
the PCRF shall provide the requested access network information
indication (e.g. user location and/or user timezone information) to the
PCEF within the Required-Access-Info AVP included within the
Charging-Rule-Definition AVP of an appropriate PCC rule; the PCRF shall
also provide the ACCESS\_NETWORK\_INFO\_REPORT event trigger within
Event-Trigger AVP (if this event trigger is not yet set).

For those PCC Rule(s) based on preliminary service information as
described in 3GPP TS 29.214 \[10\] the PCRF may assign the QCI and ARP
of the default bearer to avoid signalling to the UE. These PCC Rules
shall not include the Packet-Filter-Usage AVP within the
Flow-Information AVP included in the Charging-Rule-Definition AVP.

NOTE: 3GPP TS 23.203 provides further information about appropriate PCC
rules in sub-clause 6.2.1.0.

If the ACCESS\_NETWORK\_INFO\_REPORT event trigger is set, upon
installation, modification and removal of any PCC rule(s) containing the
Required-Access-Info AVP the PCEF shall determine if it can obtain the
required location information for the used IP CAN type. If the PCEF can
obtain the required location information, it shall apply appropriate IP
CAN specific procedures to obtain this information. When the PCEF then
receives access network information through those IP CAN specific
procedures , the PCEF shall provide the required access network
information to the PCRF within the 3GPP-User-Location-Info AVP,
User-Location-Info- Time AVP (if available) and/or 3GPP-MS-TimeZone AVP
as requested by the PCRF; the PCEF shall also provide the
ACCESS\_NETWORK\_INFO\_REPORT event trigger within Event-Trigger AVP.
The kind of user location retrieved in the access network is defined in
the corresponding annex.

During bearer deactivation or IP-CAN session termination procedure, the
PCEF shall provide the access network information to the PCRF within the
3GPP-User-Location-Info AVP and information on when the UE was last
known to be in that location within User-Location-Info-Time AVP.

If the PCRF requested user location as part of the Required-Access-Info
AVP and it is not available in the PCEF, the PCEF shall provide the
serving PLMN identifier within the 3GPP-SGSN-MCC-MNC AVP.

### 4.5.23 Application Detection Information

The PCRF may instruct the PCEF to detect application (s) by providing
the Charging-Rule-Install AVP (s) with the corresponding parameters as
follows: the application to be detected is identified by the
TDF-Application-Identifier AVP, which is either provided under
Charging-Rule-Definition AVP for dynamic PCC Rules or pre-provisioned
for the corresponding predefined PCC Rule, and in such a case only
Charging-Rule-Name/Charging-Rule-Base-Name is provided. If the PCRF
requires to be reported about when the application start/stop is
detected, it shall also subscribe to the APPLICATION\_START and
APPLICATION\_STOP Event-Triggers. The PCRF may also mute such a
notification about a specific detected application by providing
Mute-Notification AVP within the PCC Rule.

The PCEF applies the PCC rule to the whole IP-CAN session traffic for
the application detection and control. When the start or stop of the
application’s traffic, identified by TDF-Application-Identifier, is
detected, if PCRF has previously subscribed to the
APPLICATION\_START/APPLICATION\_STOP Event-Triggers, unless a request to
mute such a notification (Mute-Notification AVP) is part of the
corresponding PCC Rule, the PCEF shall report the information regarding
the detected application’s traffic in the
Application-Detection-Information AVP in the CCR command.

The corresponding TDF-Application-Identifier AVP shall be included under
Application-Detection-Information AVP. When the Event trigger indicates
APPLICATION\_START, the Flow-Information AVP for the detected
application may be included under Application-Detection-Information AVP,
if deducible. The Flow-Information AVP, if present, shall contain the
Flow-Description AVP and Flow-Direction AVP. The
TDF-Application-Instance-Identifier, which is dynamically assigned by
the PCEF in order to allow correlation of APPLICATION\_START and
APPLICATION\_STOP Event-Triggers to the specific Flow-Information AVP,
if service data flow descriptions are deducible, shall also be provided
when the Flow-Information AVP is included. Also, the corresponding
Event-Trigger (APPLICATION\_START or APPLICATION\_STOP) shall be
provided to PCRF. When the TDF-Application-Instance-Identifier is
provided along with the APPLICATION\_START, it shall also be provided
along with the corresponding APPLICATION\_STOP. The PCRF then may make
policy decisions based on the information received and send the
corresponding updated or new PCC rules to the PCEF, and corresponding
QoS rules to the BBERF, if applicable.


### 4a.5.12 IMS Emergency Session Support

#### 4a.5.12.1 PCC procedures for Emergency services over Gxx reference point

##### 4a.5.12.1.1 Gateway control and QoS Rules request for Emergency services

The BBERF executes the same procedure as for a Gateway control and QoS
Rules request unrelated to Emergency Services described in subclause
4a.5.1.

A BBERF that requests QoS Rules at Gateway Control Session Establishment
shall send a CCR command with CC-Request-Type AVP set to value
"INITIAL\_REQUEST". For case 2b the BBERF shall send the
Called-Station-Id AVP including the Emergency APN. The BBERF may include
the IMSI within the Subscription-Id AVP and if the IMSI is not available
the BBERF shall include the IMEI within the User-Equipment-Info AVP. The
BBERF may include the rest of the attributes described in subclause
4a.5.1.

If the PCRF detects that the initial or subsequent CCR command shall be
rejected, it shall execute the procedure for the type of Gx experimental
result code described in subclause 4a.5.1.

##### 4a.5.12.1.2 Provisioning of QoS Rules for Emergency services

###### 4a.5.12.1.2.1 Provisioning of QoS Rules at Gxx session establishment

The PCRF shall detect that a Gxx session is restricted to IMS Emergency
services when a CCR command is received with a CC-Request-Type AVP set
to value "INITIAL\_REQUEST" and the Called-Station-Id AVP includes a PDN
identifier that matches one of the Emergency APNs from the configurable
list. The PCRF:

- shall provision QoS Rules restricting the access to Emergency Services
(e.g. P-CSCF(s), DHCP(s) and DNS (s) and SUPL(s) addresses) as required
by local operator policies in a CCA command according to the procedures
described in clause 4a.5.2.

- may provision the authorized QoS that applies to the default EPS
bearer within the Default-EPS-Bearer-QoS AVP in a CCA command according
to the procedures described in clause 4a.5.10.1 except for obtaining the
authorized QoS upon interaction with the SPR. The value for the
Priority-Level AVP shall be assigned as required by local operator
policies (e.g. if an IMS Emergency session is prioritized the
Priority-Level AVP may contain a value that is reserved for an operator
domain use of IMSEmergency sessions). If the IP-CAN Type AVP is assigned
to "3GPP-EPS" the values for Pre-emption-Capability AVP and
Pre-emption-Vulnerability AVP shall be assigned as required by local
operator policies.

- may provision the authorized QoS that applies to an APN within the
APN-Aggregate-Max-Bitrate UL/DL in a CCA command according to the
procedures described in subclause 4a.5.10.3.

When the PCEF detects that the provisioning of QoS Rules failed, it
shall execute the procedure for the type of Gx experimental result code
described in subclause 4a.5.5.

###### 4a.5.12.1.2.2 Provisioning of QoS Rules for Emergency services

When the PCRF receives IMS service information from the AF for an
Emergency service and derives authorized QoS Rules from the service
information, the priority in the Priority-Level AVP in the QoS
information within the QoS Rule shall be assigned a value as required by
local operator policies (e.g. if an IMS Emergency session is prioritized
the Priority-Level AVP may contain a value that is reserved for an
operator domain use of IMSEmergency sessions). If the IP-CAN Type AVP is
assigned to "3GPP-EPS" the values for the Pre-emption-Capability AVP and
Pre-emption-Vulnerability AVP shall also be assigned as required by
local operator policies.

The PCRF shall derive authorized QoS Rules from the PCC Rules that are
bound to an IP-CAN session restricted to Emergency services and
immediately initiate a PUSH procedure as described in subclause 4a.5.2.1
to provision QoS Rules and the procedures described in subclause 4.5.5.2
to provision the authorized QoS per service data flow.

Any BBERF-initiated request for QoS Rules for an IMS Emergency service
triggered by Event-Trigger AVP assigned to
“RESOURCE\_MODIFICATION\_REQUEST” (i.e. UE-initiated resource
reservation) shall be rejected by the PCRF, with the error
DIAMETER\_ERROR\_TRAFFIC\_MAPPING\_INFO\_REJECTED.

The BBERF shall execute the procedures described in subclause 4a.5.2.1
and subclause 4.5.5.3 to ensure that a new IP-CAN bearer is established
for the Emergency service.

When the BBERF detects that the provisioning of QoS Rules failed, it
shall execute the procedure for the type of Gx experimental result code
described in subclause 4a.5.5.

#### 4a.5.12.2 Gateway Control Session to Gx session linking

If the Subscription-Id AVP was not received, the PCRF shall perform
Gateway Control Session to Gx session linking by using the
User-Equipment-Info AVP.

#### 4a.5.12.3 Removal of QoS Rules for Emergency Services

The reception of a request to terminate an AF session for an IMS
Emergency service by the PCRF triggers the removal of QoS Rules assigned
to the terminated IMS Emergency Service from the BBERF by using the
subclause 4a.5.2.1 to provision QoS Rules.

At reception of a RAR that removes one or several QoS Rules from an
IP-CAN Session restricted to emergency services the BBERF shall:

- when all QoS Rules bound to an IP-CAN bearer are removed, initiate an
IP-CAN bearer termination procedure.

- when not all QoS Rules bound an IP-CAN bearer are removed, initiate an
IP-CAN bearer modification procedure.

#### 4a.5.12.4 Termination of Gateway Control session for Emergency Services

The procedure to terminate a Gateway Control Session defined for case
2b) in 4a.5.3 and for case 2a) in 4a.5.4 applies.


### 4a.5.14 Multimedia Priority Support

#### 4a.5.14.1 PCC Procedures for Multimedia Priority services over Gxx reference point

##### 4a.5.14.1.1 Provisioning of QoS Rules for Multimedia Priority Services

The provision of QoS Rules corresponding to both MPS and non-MPS
services shall be performed as described in clause 4a.5.2.

The QoS Rules applicable for MPS and non-MPS services shall be derived
from the PCC Rules generated as described in clause 4.5.191.2.

When the PCRF receives a CCR command with CC-Request-Type AVP set to
value "INITIAL\_REQUEST", the PCRF shall check whether any of these
parameters are stored in the SPR: MPS EPS Priority, MPS Priority Level
and/or IMS Signalling Priority. The PCRF shall derive the QoS Rules from
the generated PCC Rules and default bearer QoS based on that
information. If the IMS Signalling Priority is set and the
Called-Station-Id AVP is received and corresponds to an APN dedicated
for IMS, the PCRF shall assign an ARP corresponding to MPS for the
default bearer and for the PCC/QoS Rules corresponding to the IMS
signalling bearer. If the Called-Station-Id AVP does not correspond to
an APN dedicated for IMS, the ARP shall be derived without considering
IMS Signalling Priority.

NOTE 0: Subscription data for MPS is provided to PCRF through the Sp
reference point.

Once the PCRF receives a notification of a change in MPS EPS Priority,
MPS Priority Level and/or IMS Signalling Priority from the SPR, the PCRF
shall make the corresponding policy decisions (i.e. ARP and/or QCI
change) and, if applicable, shall initiate a RAR command to provision
the modified data.

NOTE 1: The details associated with the Sp reference point are not
specified in this Release. The SPR’s relation to existing subscriber
databases is not specified in this Release.

NOTE 2: The MPS Priority Level is one among other input data such as
operator policy for the PCRF to set the ARP.

##### 4a.5.14.1.2 Invocation/Revocation of Priority EPS Bearer Services

When a Priority EPS Bearer Service is invoked or revoked, the PCRF shall
behave as described in clause 4.5.19.1.2. The PCRF shall derive the QoS
Rules from the applicable PCC Rules.

The PCRF shall provision the BBERF with the applicable QoS Rules upon
Priority EPS Bearer Service activation and deactivation as described in
clause 4a.5.2. The provision of the QoS information applicable for the
QoS Rules shall be performed as described in clause 4a.5.10.4. The
provision of QoS information for the default bearer shall be performed
as described in clause 4a.5.10.1.

##### 4a.5.14.1.3 Invocation/Revocation of IMS Multimedia Priority Services 

If the PCRF receives service information including an MPS session
indication and the service priority level from the P-CSCF or detects
that the P-CSCF released all the MPS Session, the PCRF shall behave as
described in clause 4.5.19.1.3. The PCRF shall derive the QoS Rules from
the applicable PCC Rules.

The PCRF shall provision the BBERF with the applicable QoS Rules upon
MPS session initiation and release as described in clause 4a.5.2. The
provision of the QoS information applicable for the QoS Rules shall be
performed as described in clause 4a.5.10.4. The provision of QoS
information for the default bearer shall be performed as described in
clause 4a.5.10.1.

### 4a.5.15 PCRF Failure and Restoration

If the BBERF needs to send a Gateway Control Session modification
request towards a PCRF which is known to have restarted since the
Gateway Control Session establishment, the BBERF should not send the
Gateway Control Session modification request towards a PCRF and the
BBERF may tear down the associated PDN connection based on operator
policy, by initiating PDN connection deactivation procedure. Emergency
and eMPS sessions should not be torn down.

NOTE 1: This mechanism enables the clean up of PDN connections affected
by the PCRF failure and leads the UE to initiate a UE requested PDN
connectivity procedure for the same APN.

NOTE 2: The method the BBERF uses to determine that a PCRF has restarted
is not specified in this release.

### 4a.5.16 Reporting Access Network Information

If the AF requests the PCRF to report the access network information,
the PCRF shall provide the requested access network information
indication (e.g. user location and/or user timezone information) to the
BBERF within the Required-Access-Info AVP included within the
QoS-Rule-Definition AVP of an appropriate QoS rule; the PCRF shall also
provide the ACCESS\_NETWORK\_INFO\_REPORT event trigger within
Event-Trigger AVP(if this event trigger is not yet set).

For those QoS Rule(s) based on preliminary service information as
described in 3GPP TS 29.214 \[10\] the PCRF may assign the QCI and ARP
of the default bearer to avoid signalling to the UE. These QoS Rules
shall not include the Packet-Filter-Usage AVP within the
Flow-Information AVP included in the QoS-Rule-Definition AVP.

NOTE: 3GPP TS 23.203 provides further information about appropriate QoS
rules in sub-clause 6.2.1.0.

If the ACCESS\_NETWORK\_INFO\_REPORT event trigger is set, upon
installation, modification and removal of any QoS rule(s) containing the
Required-Access-Info AVP the BBERF shall determine if it can obtain the
required location information for the used IP CAN type. If the BBERF can
obtain the required location information, it shall apply appropriate IP
CAN specific procedures to obtain this information. When the BBERF then
receives access network information through those IP CAN specific
procedures, the BBERF shall provide the corresponding access network
information to the PCRF within the3GPP-User-Location-Info AVP,
3GPP-User-Location-Info- Time AVP (if available) and/or 3GPP-MS-TimeZone
AVP as requested by the PCRF; the BBERF shall also provide the
ACCESS\_NETWORK\_INFO\_REPORT event trigger within Event-Trigger AVP.

During bearer deactivation or IP-CAN session termination procedure, the
BBERF shall provide the access network information to the PCRF within
the 3GPP-User-Location-Info AVP and information on when the UE was last
known to be in that location within User-Location-Info-Time AVP.

If the PCRF requested user location as part of the Required-Access-Info
AVP and it is not available in the BBERF, the BBERF shall provide the
serving PLMN identifier within the 3GPP-SGSN-MCC-MNC AVP.

4b Sd reference point
=====================

4b.1 Overview
-------------

The Sd reference point is located between the Policy and Charging Rules
Function (PCRF) and the Traffic Detection Function (TDF). For the
solicited application reporting, the Sd reference point is used for
establishment and termination of TDF session between PCRF and TDF,
provisioning of Application Detection and Control rules from the PCRF
for the purpose of traffic detection and enforcement at the TDF, usage
monitoring control of TDF session and of detected applications and
reporting of the start and the stop of a detected applications’s traffic
and transfer of service data flow descriptions for detected
applications, ifdeducible, from the TDF to the PCRF. For the unsolicited
reporting, the Sd reference point is used for establishment and
termination of TDF session between PCRF and TDF, reporting of the start
and the stop of a detected application’s traffic and transfer of service
data flow descriptions for detected applications, if deducible, and
transfer of Application instance identifier, if service data flow
descriptions are deducible, from the TDF to the PCRF.

The stage 2 level requirements for the Sd reference point are defined in
3GPP TS 23.203 \[7\].

Signalling flows related to the Sd, Rx, Gxx and Gx interfaces are
specified in 3GPP TS 29.213 \[8\].

4b.2 Sd Reference model
-----------------------

The Sd reference point is defined between the PCRF and the TDF. The
relationships between the different functional entities involved are
depicted in figure 4b.2.1 and 4b.2.2.

Figure 4b.2.1: Sd reference point at the Policy and Charging Control
(PCC) architecture with SPR

NOTE: The PCEF may support Application Detection and Control feature.

With the UDC-based architecture, as defined in 3GPP TS 23.335 \[38\] and
applied in 3GPP TS 23.203 \[7\], the UDR replaces SPR and the Ud
reference point provides access to the subscription data in the UDR. The
Ud interface as defined in 3GPP TS 29.335 \[39\] is the interface
between the PCRF and the UDR The relationships between the different
functional elements are depicted in figure 4b.2.2. When UDC architecture
is used, SPR and Sp, whenever mentioned in this document, is replaced by
UDR and Ud.

Figure 4b.2.2: Sd reference point at the Policy and Charging Control
(PCC) architecture with UDR

NOTE 1: The details associated with the Sp reference point are not
specified in this Release. The SPR’s relation to existing subscriber
databases is not specified in this Release.

NOTE 2: The UDC Application Informational Model related to the PCRF is
not specified in this Release.

NOTE 3: The PCEF may support Application Detection and Control feature.

4b.3 Application Detection and Control Rules
--------------------------------------------

### 4b.3.1 Functional entities

The PCRF may provide ADC Rules to the TDF by using Sd interface.

Once the start or stop of the application’s traffic, matching one of
those ADC Rules, is detected, if PCRF has previously subscribed to the
APPLICATION\_START/APPLICATION\_STOP Event-Triggers, unless a request to
mute such a notification (Mute-Notification AVP) is part of the
corresponding ADC Rule, the TDF shall report the information regarding
the detected application’s traffic to the PCRF and apply the enforcement
actions, if defined within the corresponding ADC Rule.

### 4b.3.2 Application Detection and Control Rule Definition

The purpose of the ADC rule is to apply the detection and enforcement
actions for the specified application traffic.

The TDF shall select an ADC rule for the traffic, matching the
application definition. When the traffic matches an application
definition, the matching process for that traffic is completed, and the
ADC rule for that application shall be applied.

There are two different types of ADC rules as defined in \[7\]:

- Dynamic ADC rules. The PCRF can however provide and modify some
parameters via the Sd reference point, respectively. These ADC rules can
be installed, modified and removed at any time. The dynamic ADC rules
are applicable only in case of solicited application reporting.

- Predefined ADC rules. Preconfigured in the TDF. In the case of
solicited reporting, the Predefined ADC rules can be activated or
deactivated by the PCRF at any time. Predefined ADC rules within the TDF
may be grouped allowing the PCRF to dynamically activate a set of ADC
rules.

An ADC rule consists of:

- a rule identifier;

- TDF application identifier;

- monitoring key;

- gate status;

- UL maximum bit rate;

- DL maximum bit rate;

- redirect;

The rule identifier shall be used to reference an ADC rule in the
communication between the TDF and the PCRF.

NOTE 1: The PCRF has to ensure that there is no dynamically provided ADC
rule that has the same rule identifier value as any of the predefined
ADC rules.

The TDF application identifier shall be used to reference the
corresponding application, for which the rule applies during reporting
to the PCRF. The same application identifier value can occur in more
than one ADC rule. If so, the PCRF shall ensure that there is at most
one ADC rule active per application identifier value at any time.

NOTE 2: The same application identifier value could be used for a
dynamic ADC rule and a pre-defined ADC rule or for multiple pre-defined
ADC rules.

The monitoring key for an ADC rule identifies a monitoring control
instance that shall be used for usage monitoring control of a particular
application or a group of applications (as identified by the predefined
or dynamic ADC rule(s)) or all detected traffic belonging to a specific
TDF session.

The gate status indicates whether the application, identified by the TDF
application identifier, may pass (gate is open) or shall be blocked
(gate is closed) in uplink and/or in downlink direction.

The UL maximum bitrate indicates the authorized maximum bitrate for the
uplink component of the detected application traffic.

The DL maximum bitrate indicates the authorized maximum bitrate for the
downlink component of the detected application traffic.

The Redirect indicates whether the uplink part of the detected
application traffic should be redirected to another controlled address.
The target redirect address may also be included.

One or more of the following parameters can be modified for a dynamic
ADC rule:

- monitoring key;

- gate status;

- UL maximum bit rate;

- DL maximum bit rate;

- redirect .

### 4b.3.3 Operations on ADC Rules

For dynamic ADC rules, the following operations are available:

- Installation: to provision an ADC rules that has not been already
provisioned.

- Modification: to modify an ADC rule already installed.

- Removal: to remove an ADC rule already installed.

For predefined ADC rules, the following operations are available:

- Activation: to allow the ADC rule being active.

- Deactivation: to disallow the ADC rule.

The procedures to perform these operations are further described in
clause 4b.5.

4b.4 Functional elements
------------------------

### 4b.4.1 PCRF

The PCRF (Policy Control and Charging Rules Function) is a functional
element that encompasses policy control decision. The PCRF provides
network control regarding the application detection, gating, bandwidth
limitation and redirection towards the TDF.

The PCRF may provision ADC Rules to the TDF via the Sd reference point.

The PCRF ADC Rule decisions may be based on one or more of the
following:

- Information obtained from the PCEF via the Gx reference point, e.g.
request type, subscriber/device related information, location
information.

- Information obtained from the SPR via the Sp reference point, e.g.
subscriber related data. The subscription information may include user
profile configuration indicating whether application detection and
control should be enabled.

NOTE: The details associated with the Sp reference point are not
specified in this Release. The SPR’s relation to existing subscriber
databases is not specified in this Release.

- Information obtained from the TDF via the Sd reference point, e.g.
detected application, usage monitoring report.

- Information obtained from the BBERF via the Gxx reference point.

- Own PCRF pre-configured information.

The PCRF shall inform the TDF through the use of ADC rules, if
applicable, on the treatment of applications, in accordance with the
PCRF policy decisions.

It is PCRF's responsibility to coordinate the PCC rules and QoS rules,
if applicable, with ADC rules in order to ensure consistent service
delivery.

### 4b.4.2 TDF

The TDF (Traffic Detection Function) is a functional entity that
performs application's traffic detection and reporting of the detected
application by using TDF application identifier and its TDF application
instance identifier and its service data flow descriptions to the PCRF
when service data flow descriptions are deducible. The TDF shall support
solicited application reporting and/or unsolicited application
reporting.

The TDF shall detect start and stop of the application traffic for the
ADC rules that the PCRF has activated at the TDF (solicited application
reporting) or which are pre-provisioned at the TDF (unsolicited
application reporting). When the APPLICATION\_START and
APPLICATION\_STOP event trigger are subscribed, the TDF shall report,
unless the notification is muted for the specific ADC rule in case of
solicited application reporting, to the PCRF:

- For the APPLICATION\_START event trigger: the application identifier
and, when service data flow descriptions are deducible, the application
instance identifier and the service data flow descriptions to use for
detecting that application traffic with a dynamic PCC rule.

- For the APPLICATION\_STOP event trigger: the application identifier
and if the application instance identifier was reported for the start,
also the application instance identifier.

For the solicited application reporting, the TDF shall perform the
following enforcement actions to the detected application traffic, if
requested by PCRF:

- Gating;

- Redirection;

- Bandwidth limitation.

For the solicited application reporting, the TDF shall support usage
monitoring as specified in clauses 4b.5.6 and 4b.5.7.

For unsolicited application reporting, the TDF shall only perform
application detection and reporting functionality.

NOTE: For unsolicited application reporting, the TDF does not perform
enforcement actions and usage monitoring.

4b.5 ADC procedures over Sd reference point for solicited application reporting
-------------------------------------------------------------------------------

### 4b.5.1 Provisioning of ADC rules

#### 4b.5.1.1 General

If PCRF decides, based on subscriber’s profile configuration, that the
TDF session should be established with the TDF per corresponding IP-CAN
session, during the IP-CAN session establishment or at any point of time
when the PCRF decides that the session with TDF is to be established
(e.g. subscriber profile changes), the PCRF shall indicate via the Sd
reference point, the ADC rules to be applied at the TDF. The
TDF-Information AVP shall be either received over Gx within initial
CC-Request received from PCEF or pre-provisioned at PCRF. Each ADC rule
shall include TDF-Application-Identifier AVP which references the
corresponding application for which the rule applies.

When establishing the session with the TDF, the PCRF shall send a
TS-Request with the PDN information, if available, within the
Called-Station-Id AVP, the UE IPv4 address within the Framed-IP-Address
and/or the UE IPv6 prefix within the Framed-IPv6-Prefix AVP. These
parameters shall uniquely identify the session between the PCRF and the
TDF. Additionally, if available (i.e. received from the PCEF or the
BBERF), the PCRF may include the following information: the user
identification within the Subscription-Id AVP, the type of IP-CAN within
the IP-CAN-Type AVP, the type of the radio access technology within the
RAT-Type AVP if applicable, the device information within
User-Equipment-Info AVP, the SGSN address within either
3GPP-SGSN-Address AVP or 3GPP-SGSN-IPv6-Address AVP, the user location
information within 3GPP-User-Location-Info or within 3GPP2-BSID, the
Routing Area Identity within RAI AVP, the IPv4 and/ or IPv6 address(es)
of the access node gateway (SGW for 3GPP and AGW for non-3GPP networks)
in the AN-GW-Address AVPs, the MCC and the MNC of the SGSN/S-GW in the
3GPP-SGSN-MCC-MNC AVP, and the UE time zone information within
3GPP-MS-TimeZone AVP. For xDSL IP-CAN Type, the Logical-Access-ID AVP
and the Physical-Access-ID AVP may be provided.

NOTE: For PDN type IPv4v6, in case the UE IPv4 address is not available
in the PCRF , the PCRF initiates the TDF session establishment providing
the UE IPv6 prefix, and will subsequently provide UE IPv4 address to the
TDF using Event-Report-Indication AVP (as specified in subclause 4b.5.8)
to the TDF.

The ADC rules may be transferred to the TDF by using one of the
following procedures:

- PUSH procedure (Unsolicited provisioning): The PCRF may decide to
provision ADC rules at TDF session establishment within TS-Request or at
any point of time within active TDF session by using RA-Request. To
provision ADC rules, the PCRF shall include those ADC rules in either
TS-Request or RA-Request message; or

- PULL procedure (Provisioning solicited by the TDF): In response to a
request for ADC rules being made by the TDF, as described in the section
4b.5.2, the PCRF shall provision ADC rules in the CC-Answer.

For each request from the TDF or upon the unsolicited provision, the
PCRF shall provision zero or more ADC rules. The PCRF may perform an
operation on a single ADC rule by one of the following means:

- To activate or deactivate an ADC rule that is predefined at the TDF,
the PCRF shall provision a reference to this ADC rule within an
ADC-Rule-Name AVP and indicate the required action by choosing either
the ADC-Rule-Install AVP or the ADC-Rule-Remove AVP.

- To install or modify a PCRF-provisioned ADC rule, the PCRF shall
provision a corresponding ADC-Rule-Definition AVP within an
ADC-Rule-Install AVP.

- To remove an ADC rule which has previously been provisioned by the
PCRF, the PCRF shall provision the name of this ADC rule as value of an
ADC-Rule-Name AVP within an ADC-Rule-Remove AVP.

As an alternative to providing a single ADC rule, the PCRF may provide
an ADC-Rule-Base-Name AVP within an ADC-Rule-Install AVP or the
ADC-Rule-Remove AVP as a reference to a group of ADC rules predefined at
the TDF. With an ADC-Rule-Install AVP, a predefined group of ADC rules
is activated. With an ADC-Rule-Remove AVP, a predefined group of ADC
rules is deactivated.

The PCRF may combine multiple of the above ADC rule operations in a
single command.

To activate a predefined ADC rule at the TDF, the rule name within an
ADC-Rule-Name AVP shall be supplied within an ADC-Rule-Install AVP as a
reference to the predefined rule. To activate a group of predefined ADC
rules within the TDF, an ADC-Rule-Base-Name AVP shall be supplied within
an ADC-Rule-Install AVP as a reference to the group of predefined ADC
rules.

To install a new or modify an already installed PCRF defined ADC rule,
the ADC-Rule-Definition AVP shall be used. If an ADC rule with the same
rule name, as supplied in the ADC-Rule-Name AVP within the
ADC-Rule-Definition AVP, already exists at the TDF, the new ADC rule
shall update the currently installed rule. If the existing ADC rule
already has attributes also included in the new ADC rule definition, the
existing attributes shall be overwritten. Any attribute in the existing
ADC rule not included in the new ADC rule definition shall remain valid.

For deactivating single predefined or removing PCRF-provided ADC rules,
the ADC-Rule-Name AVP shall be supplied within an ADC-Rule-Remove AVP.
For deactivating a group of predefined ADC rules, the ADC-Rule-Base-Name
AVP shall be supplied within an ADC-Rule-Remove AVP.

The TDF shall apply the ADC rules to the user plane traffic with the IP
address(es) matching the UE IPv4 address within the Framed-IP-Address
and/or the UE IPv6 prefix within the Framed-IPv6-Prefix AVP received
over Sd interface and report the detected applcation information via the
corresponding TDF session.

If the provisioning of ADC rules fails, the TDF informs the PCRF as
described in Clause 4b.5.5 ADC Rule Error Handling. Depending on the
cause, the PCRF may decide if re-installation, modification, removal of
ADC rules or any other action applies.

#### 4b.5.1.2 Gate function

The Gate Function represents a user plane function enabling or disabling
the forwarding of application’s traffic. A gate is applicable to the
detected application’s traffic. The Flow-Status AVP of the ADC rule
shall describe if the possible uplink and possible downlink gate for the
detected application’s traffic is opened or closed.

The commands to open or close the gate shall lead to the enabling or
disabling of the passage for corresponding detected application’s
traffic uplink/downlink. If the corresponding uplink and/or downlink
gate is closed, all packets belonging to the detected application’s
traffic uplink and/or downlink shall be dropped. If the corresponding
uplink and/or downlink gate is opened, all packets belonging to the
detected application’s traffic uplink and/or downlink are allowed to be
forwarded.

#### 4b.5.1.3 Bandwidth limitation function

The PCRF can provide the maximum allowed bit rate (QoS) for an ADC rule
to the TDF. The Provisioning shall be performed using the ADC rule
provisioning procedure. The allowed QoS shall be encoded using a
QoS-Information AVP within the ADC-Rule-Definition AVP of the ADC rule.
If QoS-Information is provided for an ADC rule, the TDF shall enforce
the corresponding policy for the detected application’s traffic. Only
the Max-Requested-Bandwidth-UL AVP and the Max-Requested-Bandwidth-DL
AVP shall be used.

#### 4b.5.1.4 Redirect function

The PCRF may provide the redirect instruction (e.g. redirect the
detected application’s traffic to another controlled address) for a
dynamic ADC rule to the TDF. The Provisioning shall be performed using
the ADC rule provisioning procedure. The redirect instruction shall be
encoded using a Redirect-Information AVP within the ADC-Rule-Definition
AVP of the dynamic ADC rule.

For a dynamic ADC rule, the redirect address may be provided as part of
the dynamic ADC rule or may be preconfigured in the TDF. A redirect
destination provided within the Redirect-Server-Address AVP in a dynamic
ADC Rule shall override the redirect destination preconfigured in the
TDF for this ADC Rule.

NOTE: The TDF uses the preconfigured redirection address only if it can
be applied to the application traffic being detected, e.g. the
redirection destination address could be preconfigured on a per
application identifier basis.

If Redirect-Information AVP is provided for a dynamic ADC rule, the TDF
shall implement the redirection for the detected application’s uplink
traffic. If the Redirect-Server-Address AVP is provided within.the
Redirect-Information AVP and the Redirect-Support AVP is not set to
REDIRECTION\_DISABLED, the TDF shall redirect the detected application’s
uplink traffic to this address. In this case, the redirect address type
(e.g. IPv4, IPv6, URL) shall be defined by the Redirect-Address-Type
AVP. If the Redirect-Server-Address AVP is not provided, the redirection
address preconfigured in the TDF shall be used instead. .If the
Redirect-Server-Address AVP is not provided and the redirection address
is not preconfigured in the TDF for the ADC rule, the TDF shall perform
ADC Rule Error Handling as specified in subclause 4b.5.5.

When the PCRF wants to disable the redirect function for an already
installed ADC Rule, the PCRF shall update the ADC rule including the
Redirect-Information AVP with Redirect-Support AVP set to
REDIRECTION\_DISABLED.

#### 4b.5.1.5 Usage Monitoring Control

Usage monitoring may be performed for application (s) associated with
one or more ADC rules.

The provisioning of usage monitoring control per ADC rule shall be
performed using the ADC rule provisioning procedure. For a dynamic ADC
rule, the monitoring key shall be set using the Monitoring-Key AVP
within the ADC-Rule-Definition AVP of the ADC rule. For a predefined ADC
rule, the monitoring key shall be included in the rule definition at the
TDF.

### 4b.5.2 Request for ADC rules

The TDF shall indicate, via the Sd reference point, a request for ADC
rules during the active TDF session established with PCRF, when a
provisioned Event trigger is met. The TDF shall send a CC-Request with
CC-Request-Type AVP set to the value "UPDATE\_REQUEST". Additionally,
the TDF shall supply the specific event which caused the request (within
the Event-Trigger AVP) and any previously provisioned affected ADC
rule(s) The ADC rules and their status shall be supplied to PCRF within
the ADC-Rule-Report AVP.

ADC rules can also be requested as a consequence of a failure in the ADC
rule installation/activation or enforcement without requiring an
Event-Trigger. For the additional information see clause 4b.5.5.

### 4b.5.3 Provisioning of Event Triggers

The PCRF may provide one or several event triggers within one or several
Event-Trigger AVP to the TDF using the ADC rule provision procedure.
Event triggers may be used to determine which event causes the TDF to
inform PCRF once occur. Provisioning of event triggers from the PCRF to
the TDF shall be done at TDF session level. The Event-Trigger AVP may be
provided in combination with the initial or subsequent ADC rule
provisioning in TSR, RAR or CCA message.

The PCRF may add new event triggers or remove the already provided ones.
In order to do so, the PCRF shall provide the new complete list of
applicable event triggers including the needed provisioned Event-Trigger
AVPs in the CCA or RARcommands.

The PCRF may remove all previously provided event triggers by providing
the Event-Trigger AVP set to the value NO\_EVENT\_TRIGGERS. When an
Event-Trigger AVP is provided with this value, no other Event-Trigger
AVP shall be provided in the CCA or RAR command. Upon reception of an
Event-Trigger AVP with this value, the TDF shall not inform PCRF of any
event.

If no Event-Trigger AVP is included in a CCA or RAR operation, any
previously provisioned event trigger shall still be applicable.

### 4b.5.4 Request of TDF Session Termination

When the corresponding IP-CAN session is terminated or at any point of
time when the PCRF decides that the session with TDF is to be terminated
(e.g. subscriber profile changes), the PCRF shall send a RAR command
including the Session-Release-Cause AVP to the TDF. The TDF shall
acknowledge the command by sending a RAA command to the PCRF and
instantly remove/deactivate all the ADC rules that have been previously
installed or activated on that TDF session.

The TDF shall send a CC-Request with CC-Request-Type AVP set to the
value "TERMINATION\_REQUEST" to PCRF to terminate the TDF session.

When the PCRF receives the CC-Request, it shall acknowledge this message
by sending a CC-Answer to the TDF.

NOTE 1: According to DCC procedures, the Diameter Credit Control session
is being terminated with this message exchange, as specified in IETF
RFC 4006 \[9\].

Signalling flows for the TDF session termination are presented in 3GPP
TS 29.213 \[8\].

### 4b.5.5 ADC Rule Error Handling

If the installation/activation of one or more ADC rules fails, the TDF
shall include one or more ADC-Rule-Report AVP(s) in either a TSA, a CCR
or an RAA command as described below for the affected ADC rules. Within
each ADC-Rule-Report AVP, the TDF shall identify the failed ADC rule(s)
by including the ADC-Rule-Name AVP(s) or ADC-Rule-Base-Name AVP(s),
shall identify the failed reason code by including a Rule-Failure-Code
AVP, and shall include the PCC-Rule-Status AVP as described below:

- If the installation/activation of one or more ADC rules fails using a
PUSH mode (i.e., the PCRF installs/activates a rule using TSR or RAR
command), the TDF shall communicate the failure to the PCRF in the
corresponding TSA/RAA response.

- If the installation/activation of one or more ADC rules fails using a
PULL mode (i.e., the PCRF installs/activates a rule using a CCA
command), the TDF shall send the PCRF a new CCR command and include the
Rule-Failure-Code AVP.

If the installation/activation of one or more new ADC rules (i.e., rules
which were not previously successfully installed) fails, the TDF shall
set the PCC-Rule-Status to INACTIVE for both the PUSH and the PULL
modes.

If the modification of a currently active ADC rule using PUSH mode
fails, the TDF shall retain the existing ADC rule as active without any
modification unless the reason for the failure has an impact also on the
existing ADC rule. The TDF shall report the modification failure to the
PCRF using the TSA/RAA command.

If the modification of a currently active ADC rule using PULL mode
fails, the TDF shall retain the existing ADC rule as active without any
modification unless the reason for the failure has an impact also on the
existing ADC rule. The TDF shall report the modification failure to the
PCRF using the CCR command.

Depending on the value of the Rule-Failure-Code for PULL and PUSH mode,
the PCRF may decide whether retaining of the old ADC rule,
re-installation, modification, removal of the ADC rule or any other
action applies.

If an ADC rule was successfully installed/activated, but can no longer
be enforced by the TDF, the TDF shall send the PCRF a new CCR command
and include an ADC-Rule-Report AVP. The TDF shall include the
Rule-Failure-Code AVP within the ADC-Rule-Report AVP and shall set the
PCC-Rule-Status to INACTIVE.

### 4b.5.6 Requesting Usage Monitoring Control

The PCRF may indicate, via the Sd reference point, the need to apply
monitoring control for the accumulated usage of network resources on a
per TDF session basis. Usage is defined as volume of user plane traffic.
The data collection for usage monitoring control shall be performed per
monitoring key, which may apply to one application (i.e. the monitoring
key is used by a single ADC rule), or to several applications (i.e., the
monitoring key is used by many ADC rules), or all detected traffic
belonging to a specific TDF session.

If the PCRF requests usage monitoring control and if at this time, the
PCRF is not subscribed to the "USAGE\_REPORT" Event-Trigger, the PCRF
shall include the Event-Trigger AVP, set to the value "USAGE\_REPORT",
in a TS-Request, CC-Answer or RA-Request.

At TDF session establishment and modification, the PCRF may provide the
applicable thresholds for usage monitoring control to the TDF, together
with the respective monitoring keys. To provide the initial threshold
for one or more monitoring key(s), the PCRF may include the threshold in
either TSR, RAR or in the response of a CCR, initiated by the TDF.

During the IP-CAN session establishment, the PCRF may receive
information about total allowed usage per PDN and/ or per UE from the
SPR, i.e. the overall amount of allowed traffic volume that are to be
monitored for the PDN connections of a user and/or total allowed usage
for Monitoring key(s) per PDN and UE and should use it when making a
decisions about usage monitoring control.

In order to provide the applicable threshold for usage monitoring
control, the PCRF shall include a Usage-Monitoring-Information AVP per
monitoring key. The threshold level shall be provided in its
Granted-Service-Unit AVP. Threshold levels may be defined for:

- the total volume only; or

- the uplink volume only; or

- the downlink volume only; or

- the uplink and downlink volume.

The PCRF shall provide the applicable threshold(s) in the
CC-Total-Octets, CC-Input-Octets or CC-Output-Octets AVPs of the
Granted-Service-Unit AVP. The monitoring key shall be provided in the
Monitoring-Key AVP. The PCRF may provide multiple usage monitoring
control instances. The PCRF shall indicate if the usage monitoring
instance applies to the TDF session or to one or more ADC rules. For
this purpose, the Usage-Monitoring-Level AVP may be provided with a
value respectively set to SESSION\_LEVEL or ADC\_RULE\_LEVEL. The PCRF
may provide one usage monitoring control instance applicable at TDF
session level and one or more usage monitoring instances applicable at
ADC Rule level.

The PCRF may provide a Monitoring-Time AVP to the TDF for the monitoring
keys(s) in order to receive reports for the accumulated usage before and
after the monitoring time occurs within the report triggered by the
events defined in 4b.5.7.2-4b.5.7.6. In such a case, there may be two
instances of Granted-Service-Unit AVP within
Usage-Monitoring-Information AVP per monitoring key. One of them
indicates the threshold levels before the monitoring time occurs, and
the other one, which includes Monitoring-Time AVP, indicates the
subsequent threshold levels after the monitoring time occurs.The
detailed functionality in such a case is defined by 4b.5.7.7.

If the PCRF wishes to modify the threshold level for one or more
monitoring keys, the PCRF shall provide the thresholds for all the
different levels applicable to the corresponding monitoring key(s).

If the PCRF wishes to modify the monitoring key for the TDF session
level usage monitoring instance, it shall disable the existing session
level monitoring usage instance following the procedures defined in
4b.5.7.4 and shall provide a new TDF session level usage monitoring
instance following the procedures defined in this clause. The PCRF may
enable the new TDF session level usage monitoring instance and disable
the existing TDF session level usage monitoring instance in the same
command.

When the accumulated usage is reported in a CCR command, the PCRF shall
indicate to the TDF if usage monitoring shall continue for that TDF
session, usage monitoring key, or both as follows:

- If monitoring shall continue for specific level(s), the PCRF shall
provide the new thresholds for the level(s) in the CC-Answer using the
same AVP as before (CC-Total-Octets, CC-Input-Octets or CC-Output-Octets
AVP within the Granted-Service-Unit AVP);

- otherwise, if the PCRF wishes to stop monitoring for specific level(s)
the PCRF shall not include an updated usage threshold in the CCA command
for the stopped level(s) i.e. the corresponding CC-Total-Octets,
CC-Input-Octets or CC-Output-Octets AVPs shall not be included within
Granted-Service-Units AVP.

When usage monitoring is enabled, the PCRF may request the TDF to report
accumulated usage for all enabled monitoring or selected monitoring keys
regardless if a usage threshold has been reached by sending to the TDF
within the Usage-Monitoring-Information AVP the Usage-Monitoring-Report
AVP set to the value USAGE\_MONITORING\_REPORT\_REQUIRED. The PCRF shall
only require TDF to report accumulated usage for one or more monitoring
keys in a CC-Answer when the TDF has not provided accumulated usage in
the CC-Request for the same monitoring key(s).

To specify the usage monitoring key for which usage is requested, the
PCRF shall include the usage monitoring key within the Monitoring-Key
AVP within the Usage-Monitoring-Information AVP. To request usage be
reported for all enabled usage monitoring keys, the PCRF shall omit the
Monitoring-Key.

The PCRF shall process the usage reports and shall perform the actions
as appropriate for each report.

### 4b.5.7 Reporting Accumulated Usage

#### 4b.5.7.1 General

When usage monitoring is enabled, the TDF shall measure the volume of
the TDF session or the volume of the particular application (s), and
report accumulated usage to the PCRF in the following conditions:

- when a usage threshold is reached;

- when all ADC rules for which usage monitoring is enabled for a
particular usage monitoring key are removed or deactivated;

- when usage monitoring is explicitly disabled by the PCRF;

- when a TDF session is terminated;

- when requested by the PCRF;

To report accumulated usage for a specific monitoring key, the TDF shall
send a CC-Request with the Usage-Monitoring-Information AVP including
the accumulated usage since the last report. The
Usage-Monitoring-Information AVP shall include the monitoring key in the
Monitoring-Key AVP and the accumulated volume usage in the
[Used-Service-Unit
AVP](http://cpi.al.sw.ericsson.se/alexserv?ID=4346&DB=22605-sapcr3i09a.alx&FN=2_15519-CSH109004_5-V2Uen.A.html#TOP#TOP).
Accumulated volume reporting shall be done for the total volume, the
uplink volume or the downlink volume as requested by the PCRF, and set
in CC-Total-Octets, CC-Input-Octets or CC-Output-Octets AVPs of
Used-Service-Unit AVP respectively. The TDF shall continue to perform
volume measurement after the report until instructed by the PCRF to stop
the monitoring.

In case a Monitoring-Time AVP was provided by the PCRF within one
instance of the Granted-Service-Unit AVP included within the
Usage-Monitoring-Information AVP for the usage monitoring control
request, the PCEF shall report as defined in 4b.5.7.7.

For cases, where the PCRF indicates in a CC-Answer command whether the
usage monitoring shall continue as a response to the reporting of
accumulated usage in a CCR command, the TDF shall behave as follows:

- if the PCRF provisions an updated usage threshold in the CCA command,
the monitoring continues using the updated threshold value provisioned
by the PCRF;

- otherwise, if the PCRF does not include an updated usage threshold in
the CCA command, the TDF shall not continue usage monitoring for that
TDF session, usage monitoring key, or both as applicable.

NOTE: When the PCRF indicates that usage monitoring shall not continue
in the CCA, the TDF does not report usage which has accumulated between
sending the CCR and receiving the CCA.

Upon receiving the reported usage from the TDF, the PCRF shall deduct
the value of the usage report from the total allowed usage for that
IP-CAN session, usage monitoring key, or both as applicable, and the
PCRF may also derive the ADC rules based on the remaining allowed usage
or reported usage and provision them to the TDF.

Additional procedures for each of the scenarios above are described in
the following subclauses of 4b.5.7.

#### 4b.5.7.2 Usage Threshold Reached

When usage monitoring is enabled for a particular monitoring key, the
TDF shall measure the volume of all traffic for the TDF session or the
corresponding application (s) and notify the PCRF when a usage threshold
for that monitoring key is reached and report the accumulated usage for
that monitoring key and include the "USAGE\_REPORT" Event-Trigger in a
CCR command with CC-Request Type AVP set to the value "UPDATE\_REQUEST"
by following the procedures to report accumulated usage defined in
clause 4b.5.7.1.

#### 4b.5.7.3 ADC Rule Removal

When the PCRF removes or deactivates the last ADC rule associated with a
usage monitoring key in an RAR or CCA command in response to a CCR
command not related to reporting usage for the same monitoring key, the
TDF shall send a new CCR command with the CC-Request-Type set to the
value "UPDATE\_REQUEST" including the Event-Trigger set to
"USAGE\_REPORT" to report accumulated usage for the usage monitoring key
within the Usage-Monitoring-Information AVP using the procedures to
report accumulated usage defined in clause 4b.5.7.1.

When the TDF reports that the last ADC rule associated with a usage
monitoring key is inactive, the TDF shall report the accumulated usage
for that monitoring key within the same CCR command if the
ADC-Rule-Report AVP was included in a CCR command; otherwise, if the
ADC-Rule-Report AVP was included in an RAA command, the TDF shall send a
new CCR command to report accumulated usage for the usage monitoring
key.

#### 4b.5.7.4 Usage Monitoring Disabled

Once enabled, the PCRF may explicitly disable usage monitoring as a
result of receiving a CCR from the TDF which is not related to reporting
usage, but related to other external triggers (e.g. subscriber profile
update), or a PCRF internal trigger. When the PCRF disables usage
monitoring, the TDF shall report the accumulated usage which has
occurred while usage monitoring was enabled since the last report.

To disable usage monitoring for a monitoring key, the PCRF shall send
the Usage-Monitoring-Information AVP including only the applicable
monitoring key within the Monitoring-Key AVP and the
Usage-Monitoring-Support AVP set to USAGE\_MONITORING\_DISABLED.

When the PCRF disables usage monitoring in a RAR or CCA command, the TDF
shall send a new CCR command with CC-Request Type AVP set to the value
"UPDATE\_REQUEST" and the Event-Trigger AVP set to "USAGE\_REPORT" to
report accumulated usage for the disabled usage monitoring key(s).

#### 4b.5.7.5 TDF Session Termination

At TDF session termination, the TDF shall send the accumulated usage
information for all monitoring keys for which usage monitoring is
enabled in the CCR command with the CC-Request-Type AVP set to the value
"TERMINATION\_REQUEST" using the procedures to report accumulated usage
defined in clause 4b.5.7.1.

#### 4b.5.7.6 PCRF Requested Usage Report

When the TDF receives the Usage-Monitoring-Information AVP including the
Usage-Monitoring-Report AVP set to the value
USAGE\_MONITORING\_REPORT\_REQUIRED, the TDF shall send a new CCR
command with CC-Request Type AVP set to the value "UPDATE\_REQUEST" and
the Event-Trigger AVP set to "USAGE\_REPORT" to report accumulated usage
for the monitoring key received in the Usage-Monitoring-Information AVP
using the procedures to report accumulated usage defined in clause
4b.5.7. If the Monitoring-Key AVP was omitted in the received
Usage-Monitoring-Information AVP, the TDF shall send the accumulated
usage for all the monitoring keys that were enabled at the time the
Usage-Monitoring-Information was received.

#### 4b.5.7.7 Report in case of Monitoring Time provided

If Monitoring-Time AVP was provided within one instance of the
Granted-Service-Unit AVP included within the
Usage-Monitoring-Information AVP by the PCRF, and if the TDF needs to
report the accumulated usage when one of the events defined in subclause
4b.5.7.2-4b.5.7.6 occurs before the monitoring time, the PCEF shall
report the accumulated usage as defined subclause 4b.5.7.2-4b.5.7.6 and
the TDF shall not retain the monitoring time; otherwise,

- If two instances of the Granted-Service-Unit AVP are provided by the
PCRF, the TDF shall reset the usage threshold to the value of the
Granted-Service-Unit AVP with the Monitoring-Time AVP.

- If only one instance of the Granted-Service-Unit AVP is provided by
the PCRF, the TDF shall reset the usage threshold to the remaining value
of the Granted-Service-Unit AVP previously sent by the PCRF (i.e.
excluding the accumulated volume usage)i

- For both cases, the usage report from the TDF shall include two
instances of the Used-Service-Unit AVP, one of them to indicate the
usage before the monitoring time and the other one accompanied by the
Monitoring-Time AVP under the same Used-Service-Unit AVP to indicate
the usage after the monitoring time.

When PCRF receives the accumulated usage report in a CCR command, the
PCRF shall indicate to the TDF if usage monitoring shall continue as
defined in subclause 4b.5.6. The PCRF may provide the Monitoring-Time
AVP again within one instance of the Granted-Service-Unit AVP if reports
for the accumulated usage before and after the provided monitoring time
are required.

### 4b.5.8 Provisioning of Event Report Indication

The TDF may request from the PCRF to be informed about specific changes
occurred in the location information/access network information in
either a TSA, a CCR or an RAA command. In this case, the PCRF shall
subscribe to the appropriate event triggers in the PCEF according to
clause 4.5.3 or in the BBERF according to clause 4a.5.8.

NOTE 1: In case the IP flow mobility feature is enabled, the TDF doesn't
have accurate information about the location and the type of RAT the
user is attached to.

After receiving the reply of the event subscription from the PCEF or the
BBERF, the PCRF shall send the event related information to the TDF by
using a RAR command.

When PCRF is notified that an event is triggered in the PCEF or the
BBERF, if the TDF has previously requested to be informed of the
specific event, the PCRF shall notify the TDF about the event occurred
together with additional related information (i.e. the parameter value).
This notification shall be done by using the Event-Report-Indication
AVP. There may be neither ADC Rule provisioning nor Event Trigger
provisioning together with event report indication in this message.

When PCRF is notified by PCEF that either an UE\_IP\_ADDRESS\_ALLOCATE
or an UE\_IP\_ADDRESS\_RELEASE event of the IP-CAN session occurs in the
PCEF, the PCRF shall notify the TDF about the event for the
corresponding TDF session. The Framed-IP-Address AVP shall also be
provided. This notification shall also be done by using the
Event-Report-Indication AVP within a RAR command. There may be neither
ADC Rules nor Event Triggers in this message. If the PCRF notifies of
the new IPv4 address to the TDF, the TDF shall additional ly apply the
ADC rules to the user plane traffic with the IP address matching the new
IPv4 address and report the detected applcation information via the
corresponding TDF session. If the PCRF notifies to the TDF that the IPv4
address has been released, the TDF shall stop applying the ADC rule to
the user plane traffic with IP address matching the released IPv4
address.

NOTE 2: The TDF does not need to subscribe the notification of the
UE\_IP\_ADDRESS\_ALLOCATE and UE\_IP\_ADDRESS\_RELEASE.

Whenever the TDF subscribes to an event report indication by using the
TSA, CCR or RAA command, the PCRF shall only send the corresponding
currently applicable values which have been updated (e.g.
3GPP-User-Location-Info, 3GPP2-BSID, etc.) to the TDF in the RAR or CCA
if available. In this case, the Event-Trigger AVPs shall not be
included.

NOTE 3: The PCRF can get the currently applicable values during the
IP-CAN session establishment procedure or during the information
reporting from the BBERF when the BBERF gets event subscription from the
PCRF as defined in subclause 5.3.7.

### 4b.5.9 Application Detection Information

For the solicited application reporting, the PCRF may instruct the TDF
to detect application (s) by providing the ADC-Rule-Install AVP (s) with
the corresponding parameters as follows: the application to be detected
is identified by the TDF-Application-Identifier AVP, which is either
provided under ADC-Rule-Definition AVP for dynamic ADC Rules or
pre-provisioned for the corresponding predefined ADC Rule, and in such a
case only ADC-Rule-Name/ADC-Rule-Base-Name is provided . If the PCRF
requires to be reported about when the application start/stop is
detected, it shall also subscribe to the APPLICATION\_START and
APPLICATION\_STOP Event-Triggers. The PCRF may also mute such a
notification about a specific detected application by providing
Mute-Notification within the corresponding ADC-Rule-Definition AVP.

When the start or stop of the application’s traffic, identified by
TDF-Application-Identifier, is detected, if PCRF has previously
subscribed to the APPLICATION\_START/APPLICATION\_STOP Event-Triggers,
unless a request to mute such a notification (Mute-Notification AVP ) is
part of the corresponding ADC-Rule-Definition AVP, the TDF shall report
the information regarding the detected application’s traffic in the
Application-Detection-Information AVP in the CCR command.

The corresponding TDF-Application-Identifier AVP shall be included under
Application-Detection-Information AVP. When the Event trigger indicates
APPLICATION\_START, the Flow-Information AVP for the detected
application may be included under Application-Detection-Information AVP,
if deducible. The Flow-Information AVP, if present, shall contain the
Flow-Description AVP and Flow-Direction AVP. The
TDF-Application-Instance-Identifier, which is dynamically assigned by
the TDF in order to allow correlation of APPLICATION\_START and
APPLICATION\_STOP Event-Triggers to the specific Flow-Information AVP,
if service data flow descriptions are deducible, shall also be provided.
Also, the corresponding Event-Trigger (APPLICATION\_START or
APPLICATION\_STOP) shall be provided to PCRF. When the
TDF-Application-Instance-Identifier is provided along with the
APPLICATION\_START, it shall also be provided along with the
corresponding APPLICATION\_STOP. The PCRF then may make the policy
decision based on the information received and send the updated PCC
rules to the PCEF, updated QoS rules to the BBERF, if applicable, and
the updated ADC rules to the TDF.

### 4b.5.10 Time of the day procedures 

TDF shall be able to perform ADC rule request as instructed by the PCRF
in a TSR, CCA or a RAR commands. Revalidation-Time, when set by the
PCRF, shall cause the TDF to trigger a PCRF interaction to request ADC
rules from the PCRF for an established TDF session. The TDF shall stop
the timer once the TDF triggers an REVALIDATION\_TIMEOUT event.

PCRF shall be able to provide a new value for the revalidation timeout
by including Revalidation-Time in CCA or RAR.

PCRF shall be able to stop the ADC revalidation timer by disabling the
REVALIDATION\_TIMEOUT event trigger.

The PCRF may control at what time the status of an ADC rule changes.

1\) If Rule-Activation-Time is specified only and has not yet occurred,
then the TDF shall set the ADC rule inactive and make it active at that
time. If Rule-Activation-Time has passed, then the TDF shall immediately
set the ADC rule active.

2\) If Rule-Deactivation-Time is specified only and has not yet occurred,
then the TDF shall set the ADC rule active and make it inactive at that
time. If Rule-Deactivation-Time has passed, then the TDF shall
immediately set the ADC rule inactive.

3\) If both Rule-Activation-Time and Rule-Deactivation-Time are
specified, and the Rule-Activation-Time occurs before the
Rule-Deactivation-Time, and also when the ADC rule is provided before or
at the time specified in the Rule-Deactivation-Time, the TDF shall
handle the rule as defined in 1) and then as defined in 2),

4\) If both Rule-Activation-Time and Rule-Deactivation-Time are
specified, and the Rule-Deactivation-Time occurs before the
Rule-Activation-Time, and also when the ADC rule is provided before or
at the time specified in the Rule-Activation-Time., the TDF shall handle
the rule as defined in 2) and then as defined in 1),

5\) If both Rule-Activation-Time and Rule-Deactivation-Time are specified
but time has passed for both, and the Rule-Activation-Time occurs before
the Rule-Deactivation-Time, then the TDF shall immediately set the ADC
rule inactive.

6\) If both Rule-Activation-Time and Rule-Deactivation-Time are specified
but time has passed for both, and the Rule-Deactivation-Time occurs
before the Rule-Activation-Time, then the PCEF shall immediately set the
ADC rule active.

ADC Rule Activation or Deactivation shall not generate any CCR commands
with ADC-Rule-Report since PCRF is already aware of the state of the
rules.

If Rule-Activation-Time or Rule-Deactivation-Time is specified in the
ADC-Rule-Install, then it shall replace the previously set values for
the specified ADC rules.

If Rule-Activation-Time AVP, Rule-Deactivation-Time AVP or both AVPs are
omitted, then any previous value for the omitted AVP is no longer valid.

The 3GPP-MS-TimeZone AVP, if available, may be used by the PCRF and by
the TDF to derive the Rule-Activation-Time and Rule-Deactivation-Time.

### 4b.5.11 PCRF Failure and Restoration

If the TDF needs to send a TDF Session update request (e.g. following
usage threshold reached) towards a PCRF which is known to have restarted
since the TDF Session establishment, the TDF should not send the TDF
Session update request towards a PCRF, and the TDF may clean up the TDF
session related information.

NOTE 1: This mechanism in the TDF removes all application traffic
control on the PDN connection and has no effect on the state of the PDN
connection. It is expected that the PCEF will perform the same detection
and clean up of PDN connections affected by the PCRF failure and
restoration

NOTE 2: The method the TDF uses to determine that a PCRF has restarted
is not specified in this release.

4b.5a ADC procedures over Sd reference point for unsolicited application reporting
----------------------------------------------------------------------------------

### 4b.5a.1 Provisioning of ADC rules 

#### 4b.5a.1.1 General

If a TDF is configured for unsolicited reporting, the TDF is
pre-configured with ADC rules which specify which applications to detect
and report. These rules are always active and are not controlled by the
PCRF.

### 4b.5a.2 Application Detection Information

When the start or stop of the application’s traffic, identified by
TDF-Application-Identifier, is detected, the TDF shall report the
information regarding the detected application’s traffic in the
Application-Detection-Information AVP in the CCR command.

1\) When the TDF detects an application for an IPv4 address or IPv6
address for which a TDF session does not exist, the TDF shall send
CC-Request with CC-Request-Type set to value “INITIAL-REQUEST”. The TDF
provides the full UE IP address using either Framed-IP-Address AVP or
Framed-IPv6-Prefix AVP and, if available, the PDN identifier. The
corresponding CCA may contain the IPv6 prefix within the
Framed-IPv6-Prefix AVPs if the established TDF session is IPv6 address
related.

2\) When an application is detected for an IPv4 address or IPv6 Prefix
for which a TDF session already exists, the TDF shall send CC-Request
with CC-Request-Type set to value “UPDATE\_REQUEST”.

NOTE: It is considered that a TDF session exists for a detected
application related to an IPv6 address if the IPv6 address belongs to
the IPv6 prefix provided by the PCRF for that TDF session,.

The corresponding TDF-Application-Identifier AVP shall be included under
Application-Detection-Information AVP. Also, the corresponding
Event-Trigger (APPLICATION\_START or APPLICATION\_STOP) shall be
provided to PCRF. When the Event trigger indicates APPLICATION\_START,
if deducible, the Flow-Information AVP for the detected application
shall be included under Application-Detection-Information AVP. The
Flow-Information AVP, if present, shall contain the Flow-Description AVP
and Flow-Direction AVP. The TDF-Application-Instance-Identifier, which
is dynamically assigned by the TDF in order to allow correlation of
APPLICATION\_START and APPLICATION\_STOP Event-Triggers to the specific
Flow-Information AVP, if service data flow descriptions are deducible,
shall also be provided.

### 4b.5a.3 Request of TDF Session Termination

In the unsolicited reporting case the session termination procedure as
defined in subclause 4b.5.4 is initiated in the following cases.

- the corresponding IP-CAN session is terminated;

- the IPv4 address of a dual stack IP-CAN session is released and there
is an active IPv4 address related TDF session for that IP-CAN session;

- at any point of time when the PCRF decides that the session with TDF
is to be terminated (e.g. subscriber profile changes).

### 4b.5a.4 TDF session to Gx session linking

When the PCRF receives the CCR command with the CC-Request-Type set to
the value "INITIAL\_REQUEST", the PCRF links the TDF session to a Gx
session, if the IPv4 address or IPv6 address of the TDF session matches
the IPv4 address or IPv6 prefix of the Gx session. The PDN information
if available in the Called-Station-Id AVP may also be used for this
session linking.

The TDF should handle each IPv4 address and IPv6 prefix, assuming the
max prefix length used in the access network, within a separate TDF
session. The PCRF shall link the separate IPv4 address related TDF
session and IPv6 address related TDF session to the same IP-CAN session
and correlate the TDF sessions.

NOTE 1: In the scenario where the TDF performs initial Application
Detection on mutiple simultaneous traffic flows for the same IPv6 prefix
(i.e. two or more traffic flows from IPv6 addresses of the same IP-CAN
session) the TDF could not be aware that those flows belong to the
same IP-CAN session until a response is received from the PCRF,
containing the IPv6 prefix. This leads to using separate TDF sessions
for the IPv6 addresses for the same IP-CAN session. The TDF reports new
application detection information related to that IPv6 prefix via any of
the TDF sessions at a later stage.

### 5.3.7 Event-Trigger AVP (All access types)

USER\_CSG\_HYBRID\_SUBSCRIBED\_INFORMATION\_CHANGE (35)

The PCRF shall use this value to indicate a request of reporting the
event that the user enters/leaves a hybrid cell that the user subscribes
to.

When the user enters a hybrid cell where the user is a member, the
User-CSG-Information AVP shall also be provided with the event report in
the CCR command. Applicable to functionality introduced with the Rel9
feature as described in subclause 5.4.1.

USER\_CSG\_ HYBRID\_UNSUBSCRIBED\_INFORMATION\_CHANGE (36)

The PCRF shall use this value to indicate a request of reporting the
event that the user enters/leaves a hybrid cell that the user does not
subscribe to.

When the user enters a hybrid cell where the user is not a member, the
User-CSG-Information AVP shall be provided with the event report in the
CCR command. Applicable to functionality introduced with the Rel9
feature as described in subclause 5.4.1.

ROUTING\_RULE\_CHANGE (37)

When used in a CCR command, this value indicates that the PCEF generated
the request because there has been a change in the IP flow mobility
routing rules for flow mobility (installation/modification/removal of
the IP flow mobility routing rule). The new IP flow mobility routing
rule information shall be provided in the Routing‑Rule‑Definition AVP
within the same CCR command. This event trigger needs no subscription.
Applicable only to IPFlowMobility functionality feature (IFOM) as
described in subclause 5.4.1.

APPLICATION\_START (39)

This value shall be used in CCA and RAR commands by the PCRF to indicate
that the PCEF shall inform the PCRF when the start of the application’s
traffic for the application, required for detection, has been
identified, unless a request to mute such a notification
(Mute-Notification AVP) is part of the corresponding
Charging-Rule-Definition AVP.

When used in a CCR command, this value indicates that the PCEF
identified the start of the corresponding application’s traffic for an
applicationidentified by a TDF-Application-Identifier AVP.The detected
application(s) shall be identified by the
Application-Detection-Information AVP(s). Applicable to functionality
introduced with the ADC feature as described in subclause 5.4.1.

For unsolicited application reporting, APPLICATION\_START Event Trigger
is always set and does not need to be subscribed by the PCRF.

NOTE: For solicited application reporting, APPLICATION\_START is always
provided together with APPLICATION\_STOP, when used by the PCRF in CCA
and RAR commands sent to the PCEF.

APPLICATION\_STOP (40)

This value shall be used in a CCA and RAR commands by the PCRF to
indicate that the PCEF shall inform the PCRF when the stop of the
application’s traffic for the application, required for detection, has
been identified, unless a request to mute such a notification
(Mute-Notification AVP) is part of the corresponding
Charging-Rule-Definition AVP.

When used in a CCR command, this value indicates that the PCEF
identified the stop of the corresponding application’s traffic for an
applicationidentified by a TDF-Application-Identifier AVP . The detected
application(s) shall be identified by the
Application-Detection-Information AVP(s). Applicable to functionality
introduced with the ADC feature as described in subclause 5.4.1.

For unsolicited application reporting, APPLICATION\_STOP Event Trigger
is always set and does not need to be subscribed by the PCRF.

CS\_TO\_PS\_HANDOVER (42)

This value shall be used in CCA and RAR command by the PCRF to indicate
that upon a CS to PS Handover, the PCEF shall inform the PCRF. When used
in a CCR command, this value indicates that the PCEF generated the
request because there is a CS to PS handover. Applicable only to CS to
PS SRVCC functionality feature (rSRVCC) as described in subclause 5.4.1.

UE\_LOCAL\_IP\_ADDRESS\_CHANGE (43)

When used in a CCR command, this value indicates that the PCEF generated
the request because the UE Local IP Address or the UDP source port
number or both assigned by the Fixed Broadband Access have changed. The
UE-Local-IP-Address AVP and/or the UDP-Source-Port AVP shall be provided
in the same request. This event trigger does not require to be
provisioned by the PCRF. Applicable to functionality introduced with the
EPC-routed feature as described in subclause 5.4.1.

H(E)NB\_LOCAL\_IP\_ADDRESS\_CHANGE (44)

When used in a CCR command, this value indicates that the PCEF generated
the request because the H(e)NB Local IP Address or the UDP source port
number or both assigned by the Fixed Broadband Access have changed. The
HeNB-Local-IP-Address AVP and/or the UDP-Source-Port AVP shall be
provided in the same request. Applicable to functionality introduced
with the EPC-routed feature as described in subclause 5.4.1.

ACCESS\_NETWORK\_INFO\_REPORT (45)

This value shall be used in CCA and RAR commands by the PCRF to indicate
that after successful installation, modification or removal of a PCC/QoS
rule , or upon termination of the IP-CAN session\\bearer, and if the AF
requests the PCRF to report the access network information, the PCEF
shall report the corresponding access network information including user
location (or PLMN identifier if the user location is not available)
and/or UE Timezone received in the corresponding IP-CAN bearer
establishment, modification or termination procedure to the PCRF,and if
available, the time UE was last known to be in that location within
User-Location-Info-Time AVP. When used in a CCR command, this value
indicates that the PCEF generated the request because the PCEF reports
the corresponding access network information to the PCRF as requested.
Applicable to functionality introduced with the NetLoc feature as
described in subclause 5.4.1.

### 5.3.58 PDN-Connection-ID AVP 

The PDN-Connection-ID AVP (AVP code 1065) is of type OctetString, and it
indicates the PDN connection to which specific information refers.

### 5.3.59 Monitoring-Key AVP 

The Monitoring-Key AVP (AVP code 1066) is of type OctetString and is
used for usage monitoring control purposes as an identifier to a usage
monitoring control instance.

### 5.3.60 Usage-Monitoring-Information AVP

The Usage-Monitoring-Information AVP (AVP code 1067) is of type Grouped,
and it contains the usage monitoring control information.

The Monitoring-Key AVP identifies the usage monitoring control instance.

The Granted-Service-Unit AVP shall be used by the PCRF to provide the
threshold level to the PCEF. The CC-Total-Octets AVP shall be used for
providing threshold level for the total volume, or the CC-Input-Octets
and/or CC-Output-Octets AVPs shall be used for providing threshold level
for the uplink volume and/or the downlink volume. Monitoring-Time AVP
shall be used for providing the time at which the PCEF shall reapply the
threshold value provided by the PCRF.

The Used-Service-Unit AVP shall be used by the PCEF to provide the
measured usage to the PCRF. Reporting shall be done, as requested by the
PCRF, in CC-Total-Octets, CC-Input-Octets or CC-Output-Octets AVPs of
Used-Service-Unit AVP. Monitoring-Time AVP shall be used to indicate the
time at which the PCEF shall reapply the threshold value provided by the
PCRF.

The Usage-Monitoring-Level AVP determines the scope of the usage
monitoring instance.

The Usage-Monitoring-Report AVP determines if accumulated usage shall be
reported for the usage monitoring key included in Monitoring-Key AVP.

The Usage-Monitoring-Support AVP determines if a usage monitoring
instance is disabled.

AVP Format:

Usage-Monitoring-Information::= &lt; AVP Header: 1067 &gt;

\[ Monitoring-Key \]

0,2\[ Granted-Service-Unit \]

0,2\[ Used-Service-Unit \]

\[ Usage-Monitoring-Level \]

\[ Usage-Monitoring-Report \]

\[ Usage-Monitoring-Support \]

\*\[ AVP \]

### 5.3.61 Usage-Monitoring-Level AVP

The Usage-Monitoring-Level AVP (AVP code 1068) is of type Enumerated and
is used by the PCRF to indicate whether the usage monitoring instance
applies to the IP-CAN session or to one or more PCC rules or to one or
more ADC rules.

If Usage-Monitoring-Level AVP is not provided, its absence shall
indicate the value PCC\_RULE\_LEVEL (1).

The following values are defined:

SESSION\_LEVEL (0)

This value, if provided within an RAR or CCA command by the PCRF,
indicates that the usage monitoring instance applies to the entire
IP-CAN session.

PCC\_RULE\_LEVEL (1)

This value, if provided within an RAR or CCA command by the PCRF
indicates that the usage monitoring instance applies to one or more PCC
rules. This value is only applicable to the Gx reference point.

ADC\_RULE\_LEVEL (2)

This value, if provided within a TSR, RAR or CCA command by the PCRF,
indicates that the usage monitoring instance applies to one or more ADC
rules. This value is only applicable to the Sd reference point. See
clause 5b.4

### 5.3.62 Usage-Monitoring-Report AVP

The Usage-Monitoring-Report AVP (AVP code 1069) is of type Enumerated
and is used by the PCRF to indicate that accumulated usage is to be
reported by the PCEF regardless of whether a usage threshold is reached.

The following values are defined:

USAGE\_MONITORING\_REPORT\_REQUIRED (0)

This value, if provided within an RAR or CCA command by the PCRF
indicates that accumulated usage shall be reported by the PCEF.

### 5.3.63 Usage-Monitoring-Support AVP

The Usage-Monitoring-Support AVP (AVP code 1070) is of type Enumerated
and is used by the PCRF to indicate whether usage monitoring shall be
disabled for certain Monitoring Key.

The following values are defined:

USAGE\_MONITORING\_DISABLED (0)

This value indicates that usage monitoring is disabled for a monitoring
key.

### 5.3.64 CSG-Information-Reporting AVP

The CSG-Information-Reporting AVP (AVP code 1071) is of type Enumerated,
it is sent from the PCRF to the PCEF to request the PCEF to report the
user CSG information change to the OFCS. The following values are
defined:

CHANGE\_CSG\_CELL (0)

This value indicates that the PCEF reports the user CSG information
change to the OFCS when the UE enters/leaves/accesses via a CSG cell.

CHANGE\_CSG\_SUBSCRIBED\_HYBRID\_CELL (1)

This value indicates that the PCEF reports the user CSG information
change to the OFCS when the UE enters/leaves/accesses via a hybrid cell
in which the subscriber is a CSG member.

CHANGE\_CSG\_UNSUBSCRIBED\_HYBRID\_CELL (2)

This value indicates that the PCEF reports the user CSG information
change to the OFCS when the UE enters/leaves/accesses via a hybrid cell
in which the subscriber is not a CSG member.

NOTE: Due to the increased signalling load, it is recommended that such
reporting applied for a limited number of subscribers only.

### 5.3.65 Flow-Direction AVP

The Flow-Direction AVP (AVP code 1080) is of type Enumerated. It
indicates the direction/directions that a filter is applicable, downlink
only, uplink only or both down- and uplink (bidirectional).

UNSPECIFIED (0)

The corresponding filter applies for traffic to the UE (downlink), but
has no specific direction declared. The service data flow detection
shall apply the filter for uplink traffic as if the filter was
bidirectional. The PCRF shall not use the value UNSPECIFIED in filters
created by the network in NW-initiated procedures. The PCRF shall only
include the value UNSPECIFIED in filters in UE-initiated procedures if
the same value is received from in the CCR request from the PCEF.

DOWNLINK (1)

The corresponding filter applies for traffic to the UE.

UPLINK (2)

The corresponding filter applies for traffic from the UE.

BIDIRECTIONAL (3)

The corresponding filter applies for traffic both to and from the UE.

NOTE: The corresponding filter data is unidirectional. The filter for
the opposite direction has the same parameters, but having the source
and destination address/port parameters swapped.

### 5.3.66 Packet-Filter-Usage AVP (All access types)

The Packet-Filter-Usage AVP (AVP code 1072) is of type of Enumerated,
and it indicates whether the UE shall be provisioned with the related
traffic mapping information, i.e. the packet filter. Traffic mapping
information may be sent to the UE as per the relevant IP-CAN
specifications even if not instructed to do so with the
Packet-Filter-Usage AVP.

The following values are defined:

SEND\_TO\_UE (1)

This value is used to indicate that the related traffic mapping
information, i.e. the packet filter, shall be sent to the UE, if
applicable to the IP-CAN type as per relevant IP-CAN specifications.

NOTE: The maximum number of packet filters sent to UE is limited by the
IP-CAN type. See access specific annexes.

### 5.3.68 Routing-Rule-Install AVP 

The Routing-Rule-Install AVP (AVP code 1081 ) is of type Grouped, and it
is used to install or modify IP flow mobility routing rules as
instructed from the PCEF to the PCRF.

For installing a new IP flow mobility routing rule or modifying a IP
flow mobility routing rule already installed, Routing-Rule-Definition
AVP shall be used.

AVP Format:

Routing-Rule-Install ::= &lt; AVP Header: 1081 &gt;

\*\[ Routing-Rule-Definition \]

\*\[ AVP \]

### 5.3.69 Routing-Rule-Remove AVP

The Routing-Rule-Remove AVP (AVP code 1075) is of type Grouped, and it
is used to remove IP flow mobility routing rules for an IP CAN session
from the PCRF.

Routing-Rule-Identifier AVP is a reference for a specific IP flow
mobility routing rule at the PCRF to be removed.

AVP Format:

Routing-Rule-Remove ::= &lt; AVP Header: 1075 &gt;

\*\[ Routing-Rule-Identifier \]

\*\[ AVP \]

### 5.3.70 Routing-Rule-Definition AVP

The Routing-Rule-Definition AVP (AVP code 1076) is of type Grouped, and
it defines the IP flow mobility routing rule sent by the PCEF to the
PCRF.

The Routing-Rule-Identifier AVP uniquely identifies the IP flow mobility
routing rule and it is used to reference to a IP flow mobility routing
rule in communication between the PCEF and the PCRF within one IP CAN
session.

The Routing-IP-Address AVP identifies the IP address to be used for
transporting for service data flows matching the IP flow mobility
routing rule. The IP address may be a care-of-address or the home
address.

The Routing-Filter AVP(s) contains detailed description of routing
filter(s) for determining the service data flows that belong to the IP
flow mobility routing rule.

AVP Format:

Routing-Rule-Definition ::= &lt; AVP Header: 1076 &gt;

{ Routing-Rule-Identifier }

\*\[ Routing-Filter \]

\[ Precedence \]

\[ Routing-IP-Address \]

\*\[ AVP \]

### 5.3.71 Routing-Rule-Identifier AVP

The Routing-Rule-Identifier AVP (AVP code 1077) is of type OctetString,
and it defines a unique identifier for IP flow mobility routing rule.
For IP flow mobility routing rules provided by the PCEF it uniquely
identifies a IP flow mobility routing rule within one IP CAN session.
The identifier value is assigned by the PCEF when instructing the PCRF
to install the IP flow mobility routing rule.

### 5.3.72 Routing-Filter AVP

The Routing-Filter AVP (AVP code 1078) is of type Grouped and is sent
from the PCEF to the PCRF. This AVP contains the information for a
single routing filter .

The Routing-Filter AVP shall include the Flow-Direction AVP with value
set to "BIDIRECTIONAL". The direction information contained in the
Flow-Description AVP shall be "out".

The routing filter may be wild carded by omitting ToS-Traffice-Class
AVP, Security-Parameter-Index AVP, and Flow-Label AVP, setting
Flow-Direction AVP to the value "BIDIRECTIONAL", setting
Flow-Description AVP to the value "permit out ip from any to any".

The Routing-Filter AVP may also include the Type-of-Service/Traffic
Class, the IPSec SPI, and the Flow Label. The values of these AVPs are
obtained from the routing information provided to the PCEF.

AVP Format:

Routing-Filter ::= &lt; AVP Header: 1078 &gt;

{ Flow-Description }

{ Flow-Direction }

\[ ToS-Traffic-Class \]

\[ Security-Parameter-Index \]

\[ Flow-Label \]

\*\[ AVP \]

### 5.3.73 Routing-IP-Address AVP 

The Routing-IP-Address AVP (AVP Code 1079) is of type Address and
contains the mobile node’s home address or care-of-address. The address
type may be IPv4 or IPv6.

### 5.3.74 Void

### 5.3.75 Void

### 5.3.76 Void

### 5.3.77 TDF-Application-Identifier AVP 

The TDF-Application-Identifier AVP (AVP Code 1088) is of type
OctetString. It references the application detection filter (e.g. its
value may represent an application such as a list of URLs, etc.) which
the PCC rule for application detection and control in the PCEF applies.
The TDF-Application-Identifier AVP references also the application in
the reporting to the PCRF.

### 5.3.78 TDF-Information AVP

The TDF-Information AVP (AVP code 1087) is of type Grouped and may be
sent from the PCEF to the PCRF in a Gx CCR with CC-Request-Type set to
INITIAL-REQUEST. This AVP contains the information about the TDF that
shall handle the application detection and reporting for that IP-CAN
Session. The PCRF shall create the TDF session with that TDF.

The TDF-Information AVP shall include either the TDF-Destination-Realm
and TDF-Destination-Host AVP, or the TDF-IP-Address AVP.

NOTE: The TDF-Information AVP may also be pre-provisioned in the PCRF.
In case the TDF-Information AVP pre-provisioned at the PCRF and not
received from the PCEF, it is being handled e.g. by configuration that
PCEF routes the traffic to the same TDF. In case the TDF-Information is
pre-provisioned in the PCRF and also the value is received in CC-Request
from the PCEF, the value received in CC-Request takes precedence over
pre-provisioned value.

AVP Format:

TDF-Information::= &lt; AVP Header: 1087 &gt;

\[ TDF-Destination-Realm \]

\[ TDF-Destination-Host \]

\[ TDF-IP-Address \]

### 5.3.79 TDF-Destination-Realm AVP

The TDF-Destination-Realm AVP (AVP code 1090) is of type
DiameterIdentity and contains the Destination-Realm of the TDF.

### 5.3.80 TDF-Destination-Host AVP

The TDF-Destination-Host AVP (AVP code 1089) is of type DiameterIdentity
and contains the Destination-Host of the TDF.

### 5.3.81 TDF-IP-Address AVP 

The TDF-IP-Address AVP (AVP Code 1091) is of type Address and contains
the address of the corresponding TDF node.

The address type may be IPv4 or IPv6.

### 5.3.82 Redirect-Information AVP 

The Redirect-Information AVP (AVP code 1085) is of type Grouped. It
indicates whether the detected application traffic should be redirected
to another controlled address. The Redirect-Information AVP is sent from
the PCRF as a part of Charging-Rule-Definition AVP.

If the Redirect-Information AVP includes the Redirect-Server-Address
AVP, the Redirect-Address-Type AVP shall also be provided indicating the
type of address given in the Redirect-Server-Address AVP.

AVP Format:

Redirect-Information ::= &lt; AVP Header: 1085 &gt;

\[ Redirect-Support \]

\[ Redirect-Address-Type \]

\[ Redirect-Server-Address \]

\*\[ AVP \]

### 5.3.83 Redirect-Support AVP 

The Redirect-Support AVP (AVP Code 1086) is of type Enumerated.

The following value is defined:

REDIRECTION\_DISABLED (0)

This value indicates that redirection is disabled for a detected
application’s traffic.

REDIRECTION\_ENABLED (1)

This value indicates that redirection is enabled for a detected
application’s traffic. This is the default value applicable if a
Redirect-Information AVP is provided for the first time and if this AVP
is not supplied.

### 5.3.84 PS-to-CS-Session-Continuity AVP (3GPP-EPS access type only)

The PS-to-CS-Session-Continuity AVP (AVP code 1099) is of type
Enumerated, and indicates whether the service data flow is a candidate
for PS to CS session continuity as specified in 3GPP TS 23.216 \[40\].

The following values are defined:

VIDEO\_PS2CS\_CONT\_CANDIDATE (0)

This value is used to indicate that the service data flow carries video
and is a candidate for PS to CS session continuity.

### 5.3.85 Void

### 5.3.86 Void

### 5.3.87 Void

### 5.3.88 Void

### 5.3.89 Void

### 5.3.90 Void

### 5.3.91 Application-Detection-Information AVP 

The Application-Detection-Information AVP (AVP code 1098) is of type
Grouped, and it is used to report once the start/stop of the application
traffic, defined by TDF-Application-Identifier, has been detected, in
case PCRF has subscribed for APPLICATION\_START/APPLICATION\_STOP
Event-Triggers, unless a request to mute such a notification
(Mute-Notification AVP) is part of the corresponding
Charging-Rule-Definition AVP to the PCEF.

The corresponding TDF-Application-Identifier AVP shall be included under
Application-Detection-Information AVP. When the Event trigger indicates
APPLICATION\_START, the Flow-Information AVP for the detected
application, if deducible, shall be included under
Application-Detection-Information AVP. When the Flow-Information AVP is
included, the TDF-Application-Instance-Identifier AVP shall also be
included. The Flow-Information AVP, if present, shall contain the
Flow-Description AVP and Flow-Direction AVP. Also, the corresponding
Event-Trigger (APPLICATION\_START or APPLICATION\_STOP) shall be
provided to PCRF. When the TDF-Application-Instance-Identifier AVP is
included with an APPLICATION\_START event, it shall also be included
when the corresponding APPLICATION\_STOP event is notified.

AVP Format:

Application-Detection-Information ::= &lt; AVP Header: 1098 &gt;

{ TDF-Application-Identifier }

\[ TDF-Application-Instance-Identifier \]

\*\[ Flow-Information \]

\*\[ AVP \]

### 5.3.92 TDF-Application-Instance-Identifier AVP

The TDF-Application-Instance-Identifier AVP (AVP Code 2802) is of type
OctetString. It shall be dynamically assigned by the PCEF supporting ADC
feature in order to allow correlation of application Start and Stop
events to the specific service data flow description, if service data
flow descriptions are deducible and shall be reported from the PCEF to
the PCRF when the flow description is deducible along with the
corresponding Event Trigger.

### 5.3.93 Void

### 5.3.94 Void

### 5.3.95 HeNB-Local-IP-Address AVP (3GPP-EPS access type only)

The HeNB-Local-IP-Address AVP (AVP code 2804) is of type Address and
contains the H(e)NB local IP address as defined in Annex E.2.1. The
H(e)NB local IP address type may be IPv4 or IPv6.

### 5.3.96 UE-Local-IP-Address AVP (Non-3GPP-EPS access type only)

The UE-Local-IP-Address AVP (AVP code 2805) is of type Address and
contains the UE local IP address as defined in Annex E.2.1. The UE local
IP address type may be IPv4 or IPv6.

### 5.3.97 UDP-Source-Port AVP (3GPP-EPS and Non-3GPP-EPS access types)

The UDP-Source-Port AVP (AVP Code 2806) is of type Unsigned32 and
contains the UDP source port number in the case that NA(P)T is detected
for supporting interworking with fixed broadband access network as
defined in Annex E.

### 5.3.98 Mute-Notification AVP 

The Mute-Notification AVP (AVP code 2809) is of type Enumerated, and it
is used to mute the notification to the PCRF of the detected
application's start/stop for the specific PCC Rule from the PCEF,

The following values are defined:

MUTE\_REQUIRED (0)

This value is used to indicate that the PCEF shall not inform the PCRF
when the application’s start/stop for the specific PCC rule(s) is
detected.

Mute-Notification AVP shall be used for solicited application reporting
only.

Absence of this AVP means that application start/stop notifications
shall be sent for the detected application.

### 5.3.99 Monitoring-Time AVP

The Monitoring-Time AVP (AVP Code 2810) is of type Time and it defines
the time at which the PCEF shall reapply the threshold value provided by
the PCRF.

### 5.3.100 AN-GW-Status AVP (3GPP-EPS access type)

The AN-GW-Status AVP (AVP code 2811) is of type Enumerated. It is sent
from the PCEF to the PCRF to indicate the status of the S-GW.

The following values are defined:

AN\_GW\_FAILED (0)

This value indicates that the AN-Gateway has failed and that the PCRF
should refrain from sending policy decisions to the PCEF until it is
informed that the AN-Gateway has been recovered.

### 5.3.101 User-Location-Info-Time AVP

The User-Location-Info-Time AVP (AVP Code 2812) is of type Time, and it
contains the NTP time at which the UE was last known to be in the
location which is reported during bearer deactivation or UE detach
procedure. The User-Location-Info-Time AVP is sent from the PCEF to the
PCRF or from the BBERF to the PCRF. The PCRF forwards it to the AF.

5b Sd protocol 
===============

5b.1 Protocol support
---------------------

The Sd application is defined as a vendor specific Diameter application,
where the vendor is 3GPP. The vendor identifier assigned by IANA to 3GPP
(<http://www.iana.org/assignments/enterprise-numbers>) is 10415. The
Application-ID for the Sd Application is 16777303 and this value shall
be used in the Diameter command header as well as any Application-ID
AVPs (Auth-Application-Id/Vendor-Specific-Application-Id) in the command
body.

5b.2 Initialization, maintenance and termination of connection and session
--------------------------------------------------------------------------

The initialization and maintenance of the connection between each PCRF
and TDF pair is defined by the underlying protocol. Establishment and
maintenance of connections between Diameter nodes is described in
RFC 3588 \[5\].

After establishing the transport connection, the PCRF and the TDF shall
advertise the support of the Sd specific Application by including the
value of the application identifier in the Auth-Application-Id AVP and
the value of the 3GPP (10415) in the Vendor-Id AVP of the
Vendor-Specific-Application-Id AVP contained in the
Capabilities‑Exchange-Request and Capabilities-Exchange-Answer commands.
The Capabilities-Exchange-Request and Capabilities-Exchange-Answer
commands are specified in the Diameter Base Protocol (RFC 3588 \[5\]).

The Diameter session on Sd is established either at the request of the
PCRF in case of solicited application reporting or at the request of the
TDF in case of unsolicited application reporting. Session modifications
may be initiated by either TDF or PCRF. Session termination is initiated
at the request of the PCRF as specified in subclause 4b.5.4.

5b.3 Sd specific AVPs
---------------------

Table 5b.3.1 describes the Diameter AVPs defined for the Sd reference
point, their AVP Code values, types, possible flag values, whether or
not the AVP may be encrypted, what access types (e.g. 3GPP-GPRS, etc.)
the AVP is applicable to, the applicability of the AVPs to charging
control, policy control or both, and which supported features the AVP is
applicable to. The Vendor-Id header of all AVPs defined in the present
document shall be set to 3GPP (10415).

Table 5b.3.1: Sd specific Diameter AVPs

  ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------- ---------------- --------------------- ------------------------- ----- ------------ ---------- ----------- ----------- -------------------------
                                                                                                                                                                                                                                                                                                            AVP Flag rules (NOTE 1)                      

  Attribute Name                                                                                                                                                                                                                                          AVP Code   Clause defined   Value Type (NOTE 2)   Must                      May   Should not   Must not

  ADC-Rule-Install                                                                                                                                                                                                                                        1092       5b.3.1           Grouped               M,V                       P                  

  ADC-Rule-Remove                                                                                                                                                                                                                                         1093       5b.3.2           Grouped               M,V                       P                  

  ADC-Rule-Definition                                                                                                                                                                                                                                     1094       5b.3.3           Grouped               M,V                       P                  

  ADC-Rule-Base-Name                                                                                                                                                                                                                                      1095       5b.3.4           UTF8String            M,V                       P                  

  ADC-Rule-Name                                                                                                                                                                                                                                           1096       5b.3.5           OctetString           M,V                       P                  

  ADC-Rule-Report                                                                                                                                                                                                                                         1097       5b.3.6           Grouped               M,V                       P                  

  NOTE 1: The AVP header bit denoted as 'M', indicates whether support of the AVP is required. The AVP header bit denoted as 'V', indicates whether the optional Vendor-ID field is present in the AVP header. For further details, see RFC 3588 \[5\].

  NOTE 2: The value types are defined in RFC 3588 \[5\].

  NOTE 3: AVPs marked with “ADC” are applicable to application detection and control.
  ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------- ---------------- --------------------- ------------------------- ----- ------------ ---------- ----------- ----------- -------------------------

### 5b.3.1 ADC-Rule-Install AVP 

The ADC-Rule-Install AVP (AVP code 1092) is of type Grouped, and it is
used to activate, install or modify ADC rules as instructed from the
PCRF.

For installing a new ADC rule or modifying an ADC rule already
installed, ADC-Rule-Definition AVP shall be used.

For activating a specific predefined ADC rule, ADC-Rule-Name AVP shall
be used as a reference for that ADC rule. The ADC-Rule-Base-Name AVP is
a reference that may be used for activating a group of predefined ADC
rules.

If Rule-Activation-Time or Rule-Deactivation-Time is specified then it
applies to all the ADC rules within the ADC-Rule-Install.

AVP Format:

ADC-Rule-Install ::= &lt; AVP Header: 1092 &gt;

\*\[ ADC-Rule-Definition \]

\*\[ ADC-Rule-Name \]

\*\[ ADC-Rule-Base-Name \]

\[ Rule-Activation-Time \]

\[ Rule-Deactivation-Time \]

\*\[ AVP \]

### 5b.3.2 ADC-Rule-Remove AVP 

The ADC-Rule-Remove AVP (AVP code 1093) is of type Grouped, and it is
used to deactivate or remove ADC rules as instructed from the PCRF.

ADC-Rule-Name AVP is a reference for a specific dynamic ADC rule to be
removed or for a specific predefined ADC rule to be deactivated. The
ADC-Rule-Base-Name AVP is a reference for a group of predefined ADC
rules to be deactivated.

AVP Format:

ADC-Rule-Remove ::= &lt; AVP Header: 1093 &gt;

\*\[ ADC-Rule-Name \]

\*\[ ADC-Rule-Base-Name \]

\*\[ AVP \]

### 5b.3.3 ADC-Rule-Definition AVP 

The ADC-Rule-Definition AVP (AVP code 1094) is of type Grouped, and it
defines the ADC rule sent by the PCRF. The ADC-Rule-Name AVP uniquely
identifies the ADC rule and it is used to reference to an ADC rule in
communication between the PCRF and the TDF within one TDF session. The
TDF Application Identifier AVP(s) determines the traffic that belongs to
the application.

If optional AVP(s) within an ADC-Rule-Definition AVP are omitted, but
corresponding information has been provided in previous Sd messages, the
previous information remains valid.

Monitoring-Key AVP contains the monitoring key that may apply to the ADC
rule.

Mute-Notification AVP value shall not be changed during an active TDF
session.

AVP Format:

ADC-Rule-Definition ::= &lt; AVP Header: 1094 &gt;

{ ADC-Rule-Name }

\[ TDF-Application-Identifier \]

\[ Flow-Status \]

\[ QoS-Information \]

\[ Monitoring-Key \]

\[ Redirect-Information \]

\[ Mute-Notification \]

\*\[ AVP \]

### 5b.3.4 ADC-Rule-Base-Name AVP 

The ADC-Rule-Base-Name AVP (AVP code 1095) is of type UTF8String, and it
indicates the name of a predefined group of ADC rules.

### 5b.3.5 ADC-Rule-Name AVP 

The ADC-Rule-Name AVP (AVP code 1096) is of type OctetString, and it
defines a name for ADC rule. For ADC rules provided by the PCRF it
uniquely identifies an ADC rule within one TDF session. For predefined
ADC rules, it uniquely identifies an ADC rule within the TDF.

### 5b.3.6 ADC-Rule-Report AVP 

The ADC-Rule-Report AVP (AVP code 1097) is of type Grouped, and it is
used to report the status of ADC rules.

The ADC-Rule-Report AVP is used to report the status of the ADC rules
which cannot be installed/activated or enforced at the TDF. In this
condition, the ADC-Rule-Name AVP is used to indicate a specific ADC rule
which cannot be installed/activated or enforced, and the
ADC-Rule-Base-Name AVP is used to indicate a group of ADC rules which
cannot be activated. The PCC-Rule-Status AVP is set to INACTIVE. The
Rule-Failure-Code indicates the reason that the ADC rules cannot be
successfully installed/activated or enforced.

AVP Format:

ADC-Rule-Report ::= &lt; AVP Header: 1097 &gt;

\*\[ ADC-Rule-Name \]

\*\[ ADC-Rule-Base-Name \]

\[ PCC-Rule-Status \]

\[ Rule-Failure-Code \]

\*\[ AVP \]

Multiple instances of ADC-Rule-Report AVPs shall be used in the case it
is required to report different PCC-Rule-Status or Rule-Failure-Code
values for different groups of rules within the same Diameter command.

5b.4 Sd re-used AVPs
--------------------

Table 5b.4 lists the Diameter AVPs re-used by the Sd reference point
from existing Diameter Applications, reference to their respective
specifications, short description of their usage within the Sd reference
pointand which supported features the AVP is applicable to. Other AVPs
from existing Diameter Applications, except for the AVPs from Diameter
base protocol, do not need to be supported. The AVPs from Diameter base
protocol are not included in table 5b.4, but they are re-used for the Sd
reference point. Unless otherwise stated, re-used AVPs shall maintain
their 'M', 'P' and 'V' flag settings. Where 3GPP Radius VSAs are
re-used, unless otherwise stated, they shall be translated to Diameter
AVPs as described in IETF RFC 4005 \[12\] with the exception that the
'M' flag shall be set and the 'P' flag may be set.

Table 5b.4: Sd re-used Diameter AVPs

  --------------------------------------------------------------------------------------------------------------------------------------------------------------- ------------------------ --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- --------------
  Attribute Name                                                                                                                                                  Reference                Description                                                                                                                                                                                                                                                                                                                                   

  AN-GW-Address                                                                                                                                                   5.3.49                   Contains the IPv4 and/ or IPv6 (if available) address(es) of the access node gateway (SGW for 3GPP and AGW for non-3GPP networks).                                                                                                                                                                                                            

  Application-Detection-Information                                                                                                                               5.3.91                   Used to report from the TDF to the PCRF once the start/stop of the application traffic, defined by TDF-Application-Identifier, has been detected.                                                                                                                                                                                             
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                           TDF is used instead of PCEF and ADC-Rule-Definition AVP is used instead of Charging-Rule-Definition AVP.                                                                                                                                                                                                                                      

  Called-Station-Id                                                                                                                                               IETF RFC 4005 \[12\]     The address the user is connected to (i.e. the PDN identifier).                                                                                                                                                                                                                                                                               

  CC-Request-Number                                                                                                                                               IETF RFC 4006 \[9\]      The number of the request for mapping requests and answers.                                                                                                                                                                                                                                                                                   

  CC-Request-Type                                                                                                                                                 IETF RFC 4006 \[9\]      The type of the CC-Request. For the Solicited application reporting, only update and termination values are applicable.                                                                                                                                                                                                                       

  Event-Report-Indication                                                                                                                                         5.3.30                   When sent from the PCRF to the TDF, it is used to report an event coming from the PCEF, BBERF or BPCF if NSWO is supported and the relevant info to the TDF. When sent from the TDF to the PCRF, it is used to provide the information about the required event triggers to the PCRF. Only Event-Trigger AVP will be supplied in this case.   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                           For 3GPP2 access, USER\_LOCATION\_CHANGE is used to report and request changes to the 3GPP2-BSID.                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                           The following values for the included Event-Trigger are applicable:                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                           SGSN\_CHANGE (0), RAT\_CHANGE (2), PLMN\_CHANGE (4), IP-CAN\_CHANGE (7), RAI\_CHANGE (12), USER\_LOCATION\_CHANGE (13), NO\_EVENT\_TRIGGERS (14), UE\_IP\_ADDRESS\_ALLOCATE (18), UE\_IP\_ADDRESS\_RELEASE (19) , AN\_GW\_CHANGE (21),                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                           UE\_TIME\_ZONE\_CHANGE (25), TAI\_CHANGE (26), ECGI\_CHANGE (27).                                                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                           The following AVPs which are included in Event-Report-Indication are applicable to Sd interface:                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                           IP-CAN-Type, RAT-Type, AN-GW-Address, 3GPP-SGSN-Address, 3GPP-SGSN-IPv6-Address, 3GPP-SGSN-MCC-MNC, RAI, 3GPP-User-Location-Info, 3GPP-MS-Timezone and Framed-IP-Address.                                                                                                                                                                     

  Event-Trigger                                                                                                                                                   5.3.7                    When sent from the PCRF to the TDF, indicates an event that shall cause a re-request of ADC rules. When sent from the TDF to the PCRF, indicates that the corresponding event has occurred at the TDF.                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                           The following values are applicable:                                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                           NO\_EVENT\_TRIGGERS (14); USAGE\_REPORT (33); APPLICATION\_START (39); APPLICATION\_STOP (40); REVALIDATION\_TIMEOUT (17).                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                           TDF is used instead of PCEF, ADC rule is used instead of PCC rule, and ADC-Rule-Definition AVP is used instead of Charging-Rule-Definition AVP.                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                           Event-Trigger AVP is also applicable in TSR command.                                                                                                                                                                                                                                                                                          

  Flow-Description                                                                                                                                                3GPP TS 29.214 \[10\]    Defines the service data flow filter parameters for a detected application, if deducible.                                                                                                                                                                                                                                                     

  Flow-Direction                                                                                                                                                  5.3.65                   It indicates the direction/directions that a filter for a detected application is applicable, downlink only, uplink only or both down- and uplink (bidirectional).                                                                                                                                                                            

  Flow-Information                                                                                                                                                5.3.53                   This parameter may be sent from the TDF to the PCRF within Application-Detection-Information AVP and contains the information from a single IP flow packet filter of an application, once detected, if deducible at TDF.                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                           Only Flow-Description AVP and Flow-Direction AVPs are used.                                                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                           See NOTE 1.                                                                                                                                                                                                                                                                                                                                   

  Flow-Status                                                                                                                                                     3GPP TS 29.214 \[10\]    This parameter may be sent from the PCRF to the TDF within ADC-Rule-Definition AVP and describe if the possible uplink and/or possible downlink gate for the detected application shall be opened or closed.                                                                                                                                  

  Framed-IP-Address                                                                                                                                               IETF RFC 4005 \[12\]     The IPv4 address allocated for the user. If NSWO is supported, the AVP contains the Local IPv4 address assigned by Fixed Broadband Access network.                                                                                                                                                                                            

  Framed-IPv6-Prefix                                                                                                                                              IETF RFC 4005 \[12\]     The IPv6 prefix allocated for the user. If NSWO is supported, the AVP contains the Local IPv6 prefix or address assigned by Fixed Broadband Access network.                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                           The encoding of the value within this Octet String type AVP shall be as defined in IETF RFC 3162 \[15\], Clause 2.3. The "Reserved", "Prefix-Length" and "Prefix" fields shall be included in this order.                                                                                                                                     
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                           For the unsolicited case, the TDF may include the valid full IPv6 address that is applicable to an IP flow or IP flows.                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                           The TDF shall set the “Prefix Length” to 128 and encode the IPv6 address of the UE within the “Prefix” field.                                                                                                                                                                                                                                 

  Granted-Service-Unit                                                                                                                                            IETF RFC 4006 \[9\]      The volume threshold for usage monitoring control purposes. Only the CC-Total-Octets or one of the CC-Input-Octets and CC-Output-Octets AVPs are re-used. Monitoring-Time AVP as defined in 5.3.99 may be optionally added to the grouped AVP if UMCH feature is supported.                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
  (NOTE 2)                                                                                                                                                                                 This AVP shall have the 'M' bit cleared.                                                                                                                                                                                                                                                                                                      

  IP-CAN-Type                                                                                                                                                     5.3.27                   Indicate the type of Connectivity Access Network in which the user is connected.                                                                                                                                                                                                                                                              

  Logical-Access-ID                                                                                                                                               ETSI TS 283 034 \[37\]   Contains a Circuit‑ID (as defined in RFC 3046 \[36\]). The Logical Access ID may explicitly contain the identity of the Virtual Path and Virtual Channel carrying the traffic.                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                           The vendor-id shall be set to ETSI (13019) \[37\].                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                           The support of this AVP shall be advertised in the capabilities exchange mechanisms (CER/CEA) by including the ETSI parameter in the Supported-Vendor-Id AVP.                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                           This AVP shall have the ‘M’ bit cleared.                                                                                                                                                                                                                                                                                                      

  Max-Requested-Bandwidth-UL                                                                                                                                      3GPP TS 29.214 \[10\]    Defines the maximum authorized bandwidth for uplink.                                                                                                                                                                                                                                                                                          

  Max-Requested-Bandwidth-DL                                                                                                                                      3GPP TS 29.214 \[10\]    Defines the maximum authorized bandwidth for downlink.                                                                                                                                                                                                                                                                                        

  Monitoring-key                                                                                                                                                  5.3.59                   An identifier to a usage monitoring control instance.                                                                                                                                                                                                                                                                                         

  Mute-Notification                                                                                                                                               5.3.98                   An indication whether application start/stop notification is to be muted for ADC Rule by the TDF, Mute-Notification AVP value shall not be changed during an active TDF session.                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                           The value defintion of Mute-Notification AVP is the same as provided by clause 5.3.98, while TDF is used instead of PCEF and ADC rule is used instead of PCC rule.                                                                                                                                                                            

  Monitoring-Time                                                                                                                                                 5.3.99                   Defines the time at which the TDF re-applies the volume threshold, provided by the PCRF. Applicable if UMCH is supported as described in the subclause 5b.4.1.                                                                                                                                                                                

  PCC-Rule-Status                                                                                                                                                 5.3.19                   Describes the status of one or a group of ADC rules.                                                                                                                                                                                                                                                                                          

  Physical-Access-ID                                                                                                                                              ETSI TS 283 034 \[37\]   Identifies the physical access to which the user equipment is connected. Includes a port identifier and the identity of the access node where the port resides.                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                           The vendor-id shall be set to ETSI (13019) \[37\].                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                           The support of this AVP shall be advertised in the capabilities exchange mechanisms (CER/CEA) by including the ETSI parameter in the Supported-Vendor-Id AVP.                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                           This AVP shall have the ‘M’ bit cleared.                                                                                                                                                                                                                                                                                                      

  QoS-Information                                                                                                                                                 5.3.16                   Defines the QoS information (bandwidth limitation) for the applications, detected by the TDF and sent from the PCRF to the TDF.                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                           Only the Max-Requested-Bandwidth-UL and the Max-Requested-Bandwidth-DL are used.                                                                                                                                                                                                                                                              

  RAI                                                                                                                                                             3GPP TS 29.061 \[11\]    Contains the Routing Area Identity of the SGSN where the UE is registered.                                                                                                                                                                                                                                                                    

  RAT-Type                                                                                                                                                        5.3.31                   Identifies the radio access technology that is serving the UE.                                                                                                                                                                                                                                                                                

  Redirect- Address-Type                                                                                                                                          IETF RFC 4006 \[9\]      Defines the address type of the address given in the Redirect-Server-Address AVP included in the ADC-Rule-Definition AVP.                                                                                                                                                                                                                     

  Redirect-Information                                                                                                                                            5.3.82                   Contains the address information of the redirect server (e.g., captive portal) with which the end user is to be connected.                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                           ADC-Rule-Definition AVP is used instead of Charging-Rule-Definition AVP.                                                                                                                                                                                                                                                                      

  Redirect-Server-Address                                                                                                                                         IETF RFC 4006 \[9\]      Defines the address of the redirect server with which the end user is to be connected.                                                                                                                                                                                                                                                        

  Redirect-Support                                                                                                                                                5.3.83                   Indicates whether redirection is disabled or enabled for an ADC rule.                                                                                                                                                                                                                                                                         

  Revalidation-Time                                                                                                                                               5.3.41                   Indicates the NTP time before which the TDF will have to re-request ADC rules.                                                                                                                                                                                                                                                                

  Rule-Failure-Code                                                                                                                                               5.3.38                   Identifies the reason an ADC rule is being reported.                                                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                           TDF is used instead of PCEF, ADC rule is used instead of PCC rule, and ADC-Rule-Definition AVP is used instead of Charging-Rule-Definition AVP.                                                                                                                                                                                               

  Rule-Activation-Time                                                                                                                                            5.3.42                   Indicates the time when rule is to be activated.                                                                                                                                                                                                                                                                                              

  Rule-Deactivation-Time                                                                                                                                          5.3.43                   Indicates the time when rule is to be deactivated.                                                                                                                                                                                                                                                                                            

  Session-Release-Cause                                                                                                                                           5.3.44                   Indicate the reason of termination initiated by the PCRF.                                                                                                                                                                                                                                                                                     

  Subscription-Id                                                                                                                                                 IETF RFC 4006 \[9\]      The identification of the subscription (IMSI, MSISDN, etc).                                                                                                                                                                                                                                                                                   

  Supported-Features                                                                                                                                              3GPP TS 29.229 \[14\]    If present, this AVP informs the destination host about the features that the origin host requires to successfully complete this command exchange.                                                                                                                                                                                            

  TDF-Application-Identifier                                                                                                                                      5.3.77                   References the application, for which the Application Detection and Control (ADC) rule applies.                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                           TDF is used instead of PCEF and ADC rule is used instead of PCC rule.                                                                                                                                                                                                                                                                         

  TDF-Application-Instance-Identifier                                                                                                                             5.3.92                   Shall be assigned and reported by the TDF to the PCRF in order to allow correlation of application Start and Stop Event-Triggers to the specific service data flow descriptions, if service data flow descriptions are deducible.                                                                                                             

  Usage-Monitoring-Information                                                                                                                                    5.3.60                   Contains the usage monitoring control information.                                                                                                                                                                                                                                                                                            

  Usage-Monitoring-Level                                                                                                                                          5.3.61                   Indicates whether the usage monitoring instance applies to the TDF session or to one or more ADC rules. Only SESSION\_LEVEL (0) referring to TDF session instead of IP-CAN session and ADC-Rule-Level (2) apply.                                                                                                                              

  Usage-Monitoring-Support                                                                                                                                        5.3.62                   Indicates whether usage monitoring shall be disabled for certain Monitoring Key.                                                                                                                                                                                                                                                              

  Usage-Monitoring-Report                                                                                                                                         5.3.63                   Indicates that accumulated usage is to be reported by the TDF regardless of whether a usage threshold is reached for certain usage monitoring key (within a Usage-Monitoring-Information AVP) .                                                                                                                                               

  Used-Service-Unit                                                                                                                                               IETF RFC 4006 \[9\]      The measured volume for usage monitoring control purposes. The volume threshold for usage monitoring control purposes. Only the CC-Total-Octets or one of the CC-Input-Octets and CC-Output-Octets AVPs are re-used. Monitoring-Time AVP as defined in 5.3.99 may be optionally added to the grouped AVP if UMCH feature is supported.        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
  (NOTE 2)                                                                                                                                                                                 This AVP shall have the 'M' bit cleared.                                                                                                                                                                                                                                                                                                      

  User-Equipment-Info                                                                                                                                             IETF RFC 4006 \[9\]      The identification and capabilities of the terminal (IMEISV, etc.)                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                           When the User-Equipment-Info-Type is set to IMEISV(0), the value within the User-Equipment-Info-Value shall be a UTF-8 encoded decimal.                                                                                                                                                                                                       

  3GPP-MS-TimeZone                                                                                                                                                3GPP TS 29.061 \[11\]    Indicate the offset between universal time and local time in steps of 15 minutes of where the MS currently resides.                                                                                                                                                                                                                           

  3GPP-SGSN-Address                                                                                                                                               3GPP TS 29.061 \[11\]    The IPv4 address of the SGSN.                                                                                                                                                                                                                                                                                                                 

  3GPP-SGSN-IPv6-Address                                                                                                                                          3GPP TS 29.061 \[11\]    The IPv6 address of the SGSN.                                                                                                                                                                                                                                                                                                                 

  3GPP-SGSN-MCC-MNC                                                                                                                                               3GPP TS 29.061 \[11\]    For GPRS the MCC and the MNC of the SGSN.                                                                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                           For 3GPP/non-3GPP accesses the MCC and the MNC provided by the serving gateway (SGW, or AGW).                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                           For TWAN, the MCC and the MNC of the selected PLMN as described in §16.2.1 of 3GPP TS 23.402 \[23\].                                                                                                                                                                                                                                          

  3GPP-User-Location-Info                                                                                                                                         3GPP TS 29.061 \[11\]    Indicates details of where the UE is currently located (e.g. SAI or CGI)                                                                                                                                                                                                                                                                      

  3GPP2-BSID                                                                                                                                                      3GPP2 X.S0057-0 \[24\]   For 3GPP2 indicates the BSID of where the UE is currently located (e.g. Cell-Id, SID, NID).                                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                           The Vendor-Id shall be set to 3GPP2 (5535) \[24\].                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                           The support of this AVP shall be advertised in the capabilities exchange mechanisms (CER/CEA) by including the value 5535, identifying 3GPP2, in a Supported-Vendor-Id AVP.                                                                                                                                                                   
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                           This AVP shall have the ‘M’ bit cleared.                                                                                                                                                                                                                                                                                                      

  TWAN-Identifier                                                                                                                                                 3GPP TS 29.061 \[11\]    Indicates the UE location in a Trusted WLAN Access Network (BSSID should be provided and SSID shall be provided)                                                                                                                                                                                                                              Trusted-WLAN

  NOTE 1: This parameter can apply only to some of the detected applications. For other applications (e.g. P2P), this parameter may not be possible to provide.

  NOTE 2: AVPs included within this grouped AVP shall have the ‘M’ bit cleared.
  --------------------------------------------------------------------------------------------------------------------------------------------------------------- ------------------------ --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- --------------

### 5b.4.1 Use of the Supported-Features AVP on the Sd reference point

The Supported-Features AVP is used during session establishment to
inform the destination host about the required and optional features
that the origin host supports. The client shall, in the first request in
a Diameter session indicate the set of supported. The server shall, in
the first answer within the Diameter session indicate the set of
features that it has in common with the client and that the server shall
support within the same Diameter session. Any further command messages
shall always be compliant with the list of supported features indicated
in the Supported-Features AVPs during session establishment. Features
that are not advertised as supported shall not be used to construct the
command messages for that Diameter session. Unless otherwise stated, the
use of the Supported-Features AVP on the Sd reference point shall be
compliant with the requirements for dynamic discovery of supported
features and associated error handling on the Sd reference point as
defined in subclause 7.2.1 of 3GPP TS 29.229 \[14\].

The base functionality for the Sd reference point is the 3GPP Rel-11
standard and a feature is an extension to that functionality. If the
origin host does not support any features beyond the base functionality,
the Supported-Features AVP may be absent from the Sd commands. As
defined in subclause 7.1.1 of 3GPP TS 29.229 \[14\], when extending the
application by adding new AVPs for a feature, the new AVPs shall have
the M bit cleared and the AVP shall not be defined mandatory in the
command ABNF.

As defined in 3GPP TS 29.229 \[14\], the Supported-Features AVP is of
type grouped and contains the Vendor-Id, Feature-List-ID and
Feature-List AVPs. On the Sd reference point, the Supported-Features AVP
is used to identify features that have been defined by 3GPP and hence,
for features defined in this document, the Vendor-Id AVP shall contain
the vendor ID of 3GPP (10415). If there are multiple feature lists
defined for the Sd reference point, the Feature-List-ID AVP shall
differentiate those lists from one another.

On receiving an initial request application message, the destination
host shall act as defined in subclause 7.2.1 of 3GPP TS 29.229 \[14\].
The following exceptions apply to the initial TSR/TSA command pair:

- If the TDF supports post-Rel-11 Sd functionality, the TSA shall
include the features supported by the TDF within Supported-Features
AVP(s) with the 'M' bit cleared.

NOTE: One instance of Supported-Features AVP is needed per
Feature-List-ID.

- If the TSR command does not contain any Supported-Features AVP(s), the
TSA command shall not include the Supported-Features AVP. In this case,
both TDF and PCRF shall behave as specified in the Rel-11 version of
this document without UMCH feature.

Once the PCRF and TDF have negotiated the set of supported features
during session establishment, the set of common features shall be used
during the lifetime of the Diameter session.

The table below defines the features applicable to the Gx interfaces for
the feature list with a Feature-List-ID of 1.

Table 5b.4.1.1: Features of Feature-List-ID 1 used in Sd

  ----------------------------------------------------------------------------------------------------------------------------- -------------- ----- ------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  Feature bit                                                                                                                   Feature        M/O   Description

  0                                                                                                                             UMCH           O     This feature indicates support for Usage Monitoring Congestion Handling. If the TDF supports this feature, the benaviour shall be as specified in subclauses 4b.5.7.7.

  1                                                                                                                             Trusted-WLAN   O     This feature indicates the support for the Trusted WLAN access as defined in 3GPP TS 23.402 \[23\].

  Feature bit:The order number of the bit within the Feature-List AVP where the least significant bit is assigned number "0".

  Feature: A short name that can be used to refer to the bit and to the feature, e.g. "EPS".

  M/O: Defines if the implementation of the feature is mandatory ("M") or optional ("O") in this 3GPP Release.

  Description: A clear textual description of the feature.
  ----------------------------------------------------------------------------------------------------------------------------- -------------- ----- ------------------------------------------------------------------------------------------------------------------------------------------------------------------------

5b.5 Sd specific Experimental-Result-Code AVP values
----------------------------------------------------

### 5b.5.1 General

RFC 3588 \[5\] specifies the Experimental-Result AVP containing
Vendor-ID AVP and Experimental-Result-Code AVP. The
Experimental-Result-Code AVP (AVP Code 298) is of type Unsigned32 and
contains a vendor-assigned value representing the result of processing a
request. The Vendor-ID AVP shall be set to 3GPP (10415).

### 5b.5.2 Success

Result Codes that fall within the Success category are used to inform a
peer that a request has been successfully completed.

The Result-Code AVP values defined in Diameter BASE RFC 3588 \[5\] shall
be applied.

### 5b.5.3 Permanent Failures

Errors that fall within the Permanent Failures category shall be used to
inform the peer that the request failed, and should not be attempted
again.

The Result-Code AVP values defined in Diameter BASE RFC 3588 \[5\] are
applicable. Also the following specific Gx Experimental-Result-Codes
value is reused for TDF session: DIAMETER\_ADC\_RULE\_EVENT (see
5.5.3).:

### 5b.5.4 Transient Failures

Errors that fall within the transient failures category are used to
inform a peer that the request could not be satisfied at the time it was
received, but may be able to satisfy the request in the future.

The Result-Code AVP values defined in Diameter Base RFC 3588 \[5\] are
applicable.

5b.6 Sd Messages
----------------

### 5b.6.1 Sd Application

Sd Messages are carried within the Diameter Application(s) described in
clause 5b.1.

In addition to the TDF-Session-Request/Answer commands used to establish
the TDF session, existing Diameter command codes from the Diameter base
protocol RFC 3588 \[5\] and the Diameter Credit Control Application RFC
4006 \[9\] are used with the Sd specific AVPs specified in clause 5b.3.
The Diameter Credit Control Application AVPs and AVPs from other
Diameter applications that are re-used are defined in clause 5b.4. Due
to the definition of these reused commands there is no possibility to
skip the Auth-Application-Id AVP and use the
Vendor-Specific-Application-Id AVP instead. Therefore the Sd application
identifier shall be included in the Auth-Application-Id AVP for the
reused commands. The Sd application identifier shall be included in the
Auth-Application-Id AVP within the Vendor-Specific-Application-Id
grouped AVP contained in the TDF-Session-Request/Answer commands.

In order to support both PULL and PUSH procedures, a Diameter session
needs to be established for each TDF session, if there is a decision
made by PCRF to establish TDF session.

NOTE: Some of the AVPs included in the messages formats below are in
bold to highlight that these AVPs are used by this specific protocol and
do not belong to the original message definition in the DCC Application
RFC 4006 \[9\] or Diameter Base Protocol RFC 3588 \[5\].

### 5b.6.2 TDF-Session-Request (TSR) Command

The TSR command, indicated by the Command-Code field set to 8388637 and
the 'R' bit set in the Command Flags field, is sent by the PCRF to the
TDF in order to establish the TDF session and to provision the ADC
rules. It may also include the requested event triggers.

Message Format:

&lt;TS-Request&gt; ::= &lt; Diameter Header: 8388637, REQ, PXY &gt;

&lt; Session-Id &gt;

{ Vendor-Specific-Application-Id }

{ Origin-Host }

{ Origin-Realm }

{ Destination-Realm }

\[ Destination-Host \]

\[ Origin-State-Id \]

\*\[ Subscription-Id \]

\***\[ Supported-Features \]**

**\[ Framed-IP-Address \]**

**\[ Framed-IPv6-Prefix \]**

**\[ IP-CAN-Type \]**

**\[ RAT-Type \]**

**\[ User-Equipment-Info \]**

**0\*2\[ AN-GW-Address \]**

**\[ 3GPP-SGSN-Address \]**

**\[ 3GPP-SGSN-IPv6-Address \]**

**\[ 3GPP-SGSN-MCC-MNC \]**

**\[ RAI \]**

**\[ 3GPP-User-Location-Info \]**

**\[ TWAN-Identifier \]**

**\[ 3GPP-MS-TimeZone \]**

\[ Called-Station-Id \]

**\*\[ ADC-Rule-Install \]**

**\[ Revalidation-Time \]**

**\*\[ Usage-Monitoring-Information \]**

**\*\[ Event-Trigger\]**

\[ Logical-Access-ID \]

\[ Physical-Access-ID \]

\[ 3GPP2-BSID \]

\*\[ Proxy-Info \]

\*\[ Route-Record \]

\*\[ AVP \]

### 5b.6.3 TDF-Session-Answer (TSA) Command

The TSA command, indicated by the Command-Code field set to 8388637and
the 'R' bit cleared in the Command Flags field, is sent by the TDF to
the PCRF in response to the TS-Request command.

Message Format:

&lt;TS-Answer&gt; ::= &lt; Diameter Header: 8388637, PXY &gt;

&lt; Session-Id &gt;

{ Vendor-Specific-Application-Id }

{ Origin-Host }

{ Origin-Realm }

\[ Result-Code \]

\[ Experimental-Result \]

\[ Origin-State-Id \]

**\*\[ Supported-Features \]**

\***\[ ADC-Rule-Report \]**

**\[ Event-Report-Indication \]**

**\[ Error-Message \]**

**\[ Error-Reporting-Host \]**

\*\[ Failed-AVP \]

\*\[ Proxy-Info \]

\*\[ Route-Record \]

\*\[ AVP \]

### 5b.6.4 CC-Request (CCR) Command

The CCR command, indicated by the Command-Code field set to 272 and the
'R' bit set in the Command Flags field, is sent by the TDF to the PCRF
in order to request ADC rules or to inform PCRF about the application
detection. It is also sent to the PCRF in case of TDF session
termination, following receipt of the corresponding RAR command from the
PCRF.

Message Format:

&lt;CC-Request&gt; ::= &lt; Diameter Header: 272, REQ, PXY &gt;

&lt; Session-Id &gt;

{ Auth-Application-Id }

{ Origin-Host }

{ Origin-Realm }

{ Destination-Realm }

{ CC-Request-Type }

{ CC-Request-Number }

\[ Destination-Host \]

\[ Origin-State-Id \]

**\[ Framed-IP-Address \]**

**\[ Framed-IPv6-Prefix \]**

**\*\[ ADC-Rule-Report\]**

**\*\[ Application-Detection-Information \]**

**\*\[ Event-Trigger\]**

**\[ Event-Report-Indication \]**

**\*\[ Usage-Monitoring-Information \]**

\*\[ Proxy-Info \]

\*\[ Route-Record \]

\***\[ Supported-Features \]**

\*\[ AVP \]

NOTE 1: For the Solicited application reporting, only CC-Request-Type
equal to UPDATE\_REQUEST and TERMINATION\_REQUEST are used.

### 5b.6.5 CC-Answer (CCA) Command

The CCA command, indicated by the Command-Code field set to 272 and the
'R' bit cleared in the Command Flags field, is sent by the PCRF to the
TDF in response to the CCR command. It is used to provision ADC rules
and event triggers for the TDF session and to acknowledge the report of
the application’s traffic start/stop.

Message Format:

&lt;CC-Answer&gt; ::= &lt; Diameter Header: 272, PXY &gt;

&lt; Session-Id &gt;

{ Auth-Application-Id }

{ Origin-Host }

{ Origin-Realm }

\[ Result-Code \]

\[ Experimental-Result \]

{ CC-Request-Type }

{ CC-Request-Number }

**\[ Framed-IPv6-Prefix \]**

**\*\[ Event-Trigger \]**

**\[ Event-Report-Indication \]**

\[ Origin-State-Id \]

\*\[ Redirect-Host \]

\[ Redirect-Host-Usage \]

\[ Redirect-Max-Cache-Time \]

**\*\[ ADC-Rule-Remove \]**

**\*\[ ADC-Rule-Install \]**

**\[ Revalidation-Time \]**

**\*\[ Usage-Monitoring-Information \] **

**\[ Error-Message \]**

**\[ Error-Reporting-Host \]**

\*\[ Failed-AVP \]

\*\[ Proxy-Info \]

\*\[ Route-Record \]

\***\[ Supported-Features \]**

\*\[ AVP \]

NOTE 1: For the Solicited application reporting, only CC-Request-Type
equal to UPDATE\_REQUEST and TERMINATION\_REQUEST are used.

NOTE 2: Framed-IPv6-Prefix AVP is applicable only for the Unsolicited
Application Reporting.

### 5b.6.6 Re-Auth-Request (RAR) Command

The RAR command, indicated by the Command-Code field set to 258 and the
'R' bit set in the Command Flags field, is sent by the PCRF to the TDF
in order to provision ADC rules using the PUSH procedure for solicited
application reporting. It is also used to provision event triggers and
to report event report indications for the TDF session for solicited
application reporting and to request the TDF session termination for
both solicited and unsolicited application reporting.

Message Format:

&lt;RA-Request&gt; ::= &lt; Diameter Header: 258, REQ, PXY &gt;

&lt; Session-Id &gt;

{ Auth-Application-Id }

{ Origin-Host }

{ Origin-Realm }

{ Destination-Realm }

{ Destination-Host }

{ Re-Auth-Request-Type }

\[ Session-Release-Cause \]

\[ Origin-State-Id \]

**\*\[ Event-Trigger \]**

**\[ Event-Report-Indication \]**

**\*\[ ADC-Rule-Remove \]**

**\*\[ ADC-Rule-Install \]**

**\[ Revalidation-Time \]**

**\*\[ Usage-Monitoring-Information \]**

\*\[ Proxy-Info \]

\*\[ Route-Record \]

\*\[ AVP\]

### 5b.6.7 Re-Auth-Answer (RAA) Command

The RAA command, indicated by the Command-Code field set to 258 and the
'R' bit cleared in the Command Flags field, is sent by the TDF to the
PCRF in response to the RAR command.

Message Format:

&lt;RA-Answer&gt; ::= &lt; Diameter Header: 258, PXY &gt;

&lt; Session-Id &gt;

{ Origin-Host }

{ Origin-Realm }

\[ Result-Code \]

\[ Experimental-Result \]

\[ Origin-State-Id \]

\* **\[ ADC-Rule-Report \]**

**\[ Event-Report-Indication \]**

\[ Error-Message \]

\[ Error-Reporting-Host \]

\* \[ Failed-AVP \]

\* \[ Proxy-Info \]

\* \[ AVP \]